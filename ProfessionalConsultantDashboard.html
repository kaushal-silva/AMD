<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMD Professional Consultant Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .bg-gray-gradient {
            background-image: linear-gradient(to right, #6b7280, #4b5563); /* Gray 500 to 700 */
        }
        .section-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .data-point {
            padding: 0.75rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        .tab-button {
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #4b5563;
            border-radius: 0.5rem;
            transition: all 0.15s ease;
        }
        .tab-button.active {
            background-color: #e5e7eb; 
            color: #1f2937;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border-right: 3px solid #4b5563;
        }
        .tab-button:not(.active):hover {
            background-color: #f3f4f6;
        }
        /* Tracker Styles */
        .tracker-header {
            font-size: 0.6rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            padding: 0.75rem 0.5rem;
            vertical-align: middle;
            line-height: 1.2;
        }
        /* Custom styling for the range input track/thumb */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #4b5563; /* Gray 600 */
            cursor: pointer;
            margin-top: -7px; 
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
        }
        .alert-red {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            color: #b91c1c;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        /* Custom modal animation */
        .modal-fade-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-fade-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 200ms ease-out, transform 200ms ease-out;
        }
    </style>
</head>
<body>

    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-gray-gradient shadow-md">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                <h1 id="header-title" class="text-3xl font-bold text-white" data-key="header_title">Professional Consultant Dashboard</h1>
                <div class="flex items-center space-x-4">
                    <button id="lang-toggle" onclick="toggleLanguage()" class="py-1 px-3 rounded-full bg-white text-gray-700 border border-gray-500 hover:bg-gray-100 transition duration-150 font-semibold text-sm shadow">
                        中文
                    </button>
                    <a href="index.html" class="text-sm font-medium text-gray-200 hover:text-white" data-key="logout_link">← Log Out / Portal</a>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            
            <!-- PDPA Compliance Banner -->
            <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-800 p-4 mb-8 rounded-lg shadow-md" role="alert">
                <p class="font-bold text-lg mb-2" data-key="pdpa_banner_title">PDPA Compliance & Pseudonymization Enforced</p>
                <p class="text-sm" data-key="pdpa_banner_text_1">
                    All cases displayed are **pseudonymized** (Client ID only) to protect patient identity.
                </p>
                <p class="text-sm mt-1 font-semibold" data-key="pdpa_banner_text_2">
                    Access requires: (1) Written Patient Consent, (2) Executed Data Processing Agreement (DPA).
                </p>
            </div>

            <!-- Master Case Tracker Section -->
            <div class="section-card mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2 text-gray-700" data-key="search_title">Referred Case Tracker</h2>
                
                <div class="flex flex-col md:flex-row gap-4 items-center mb-6">
                    <input type="text" id="case-search" data-key="search_placeholder" placeholder="Search by Client ID or Practitioner Name..." class="flex-grow p-3 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-gray-500">
                    <button onclick="searchCases()" class="py-3 px-6 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition duration-150 w-full md:w-auto" data-key="btn_search">
                        Search Cases
                    </button>
                </div>

                <div class="overflow-x-auto no-scrollbar">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="tracker-header" data-key="col_id">Client ID</th>
                                <th class="tracker-header" data-key="col_doc_clinic">Referring Doctor / Clinic</th>
                                <th class="tracker-header text-center" data-key="col_ceph">Lateral Ceph S+</th>
                                <th class="tracker-header text-center" data-key="col_schwarz">Models (Schwartz)</th>
                                <th class="tracker-header text-center" data-key="col_photos">Dental+Facial Photos</th>
                                <th class="tracker-header text-center" data-key="col_cbct">CBCT Imaging</th>
                                <th class="tracker-header text-center" data-key="col_rx">RX to Lab</th>
                                <th class="tracker-header text-center" data-key="col_sta">STA Date</th>
                                <th class="tracker-header text-right pr-4" data-key="col_status">Action</th>
                            </tr>
                        </thead>
                        <tbody id="case-tracker-body" class="bg-white divide-y divide-gray-200 text-sm">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Case Details View -->
            <div id="case-details-view" class="hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b pb-4 section-card gap-4">
                    <h2 id="case-details-title" class="text-3xl font-black text-gray-900" data-key="case_details_title">Case Review: Client ID <span id="client-id-display" class="text-gray-500"></span></h2>
                    <button class="py-3 px-6 bg-yellow-600 text-white font-black text-xs rounded-xl shadow-lg uppercase tracking-widest hover:bg-yellow-700 transition duration-150" onclick="openSubmitModal()" data-key="btn_submit_opinion_header">
                        Submit Professional Opinion
                    </button>
                </div>

                <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                    <div class="lg:col-span-1 mb-8 lg:mb-0">
                        <div class="bg-white p-4 rounded-xl shadow-lg lg:sticky lg:top-8">
                            <h3 class="text-xs font-black text-gray-400 uppercase mb-4 border-b pb-2" data-key="nav_case_title">Case File Navigation</h3>
                            <nav class="flex flex-col space-y-2">
                                <button class="tab-button active" onclick="switchCaseTab('case-diagnostics')" data-key="case_tab_diagnostics">Diagnostic Inputs</button>
                                <button class="tab-button" onclick="switchCaseTab('case-progress')" data-key="case_tab_progress">Progress Tracker</button>
                                <button class="tab-button" onclick="switchCaseTab('case-history')" data-key="case_tab_history">Consultation History</button>
                            </nav>
                        </div>
                    </div>

                    <div class="lg:col-span-3 space-y-8">
                        <div id="tab-case-diagnostics" class="case-tab-content space-y-8">
                            <div class="section-card">
                                <h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-2 text-indigo-600" data-key="diagnostics_title">Shared Diagnostic Inputs</h2>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="border p-4 rounded-xl bg-gray-50">
                                        <h3 class="text-xs font-bold text-indigo-700 uppercase mb-2" data-key="cbct_title">CB CT Scan (Airway)</h3>
                                        <div id="mcs-status-display" class="font-bold text-lg mb-2">MCS: 285 mm²</div>
                                        <p class="text-[10px] text-gray-500 italic" data-key="cbct_note">Note: Significant restriction noted in velopharynx.</p>
                                    </div>
                                    <div class="border p-4 rounded-xl bg-gray-50">
                                        <h3 class="text-xs font-bold text-indigo-700 uppercase mb-2" data-key="intraoral_title">3D Intra-Oral Scan (Teeth)</h3>
                                        <p class="text-sm font-bold text-green-600 mb-2" data-key="analysis_ready">Analysis ready</p>
                                        <p class="text-[10px] text-gray-500 italic">Schwarz: 5mm maxillary posterior crossbite correction needed.</p>
                                    </div>
                                    <div class="border p-4 rounded-xl bg-gray-50">
                                        <h3 class="text-xs font-bold text-indigo-700 uppercase mb-2" data-key="ceph_title">Lateral Cephalometric Analysis</h3>
                                        <p class="text-sm font-bold text-green-600 mb-2" data-key="analysis_ready">Analysis ready</p>
                                        <p class="text-[10px] text-gray-500 italic">S+ Tracing confirmed. Current FMA: 23°.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tab-case-progress" class="case-tab-content space-y-8 hidden">
                            <div class="section-card">
                                <h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-2 text-sky-600" data-key="progress_tracker_title">Progress Photo Timeline</h2>
                                <div class="bg-gray-100 p-4 rounded-xl mb-4">
                                    <label for="c-comparison-slider" id="c-comparison-label" class="block text-sm font-medium text-gray-700 mb-2" data-key="viewing_photos">Viewing photos from: Month 6 Check</label>
                                    <input type="range" min="0" max="4" value="2" step="1" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer" id="c-comparison-slider" oninput="updateConsultantComparisonView(this.value)">
                                </div>
                                <div id="photo-comparison-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                            </div>
                        </div>

                        <div id="tab-case-history" class="case-tab-content space-y-8 hidden">
                            <div class="section-card">
                                <h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-2 text-red-600" data-key="consultation_history_title">Consultation History</h2>
                                <div class="space-y-3">
                                    <div class="data-point border-l-4 border-gray-400">
                                        <p class="text-xs font-bold text-gray-800 uppercase tracking-widest">Referral Request</p>
                                        <p class="text-sm text-gray-600 mt-1">Referred by Dr. Ryan Chiang for specialist design protocol. (2025/12/12)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="mt-6 w-full py-4 bg-yellow-600 text-white font-black rounded-xl shadow-xl uppercase tracking-widest hover:bg-yellow-700 transition duration-150" onclick="openSubmitModal()" data-key="btn_submit_opinion">
                    Submit Professional Opinion
                </button>
            </div>
        </main>
    </div>
    
    <!-- Opinion Modal -->
    <div id="opinion-modal" class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-50 hidden p-4">
        <div id="opinion-modal-content" class="bg-white w-full max-w-xl p-8 rounded-2xl shadow-2xl relative modal-fade-enter">
            <h3 class="text-xl font-black text-gray-800 mb-4 border-b pb-2 uppercase tracking-tight" data-key="opinion_modal_title">Submit Opinion for Client ID <span id="opinion-client-id" class="text-gray-400"></span></h3>
            <p class="text-sm text-gray-600 mb-4" data-key="opinion_modal_prompt">Provide your design blueprint recommendation for the STA lab.</p>
            <textarea id="opinion-textarea" rows="6" class="w-full p-4 border border-gray-300 rounded-xl outline-none focus:ring-2 focus:ring-yellow-500 text-sm" placeholder="..." data-key="opinion_textarea_placeholder"></textarea>
            <div class="flex gap-4 mt-6">
                <button onclick="closeModal('opinion-modal')" class="flex-1 py-3 bg-gray-100 text-gray-500 rounded-xl font-black text-xs uppercase" data-key="btn_cancel">Cancel</button>
                <button onclick="submitOpinion()" class="flex-1 py-3 bg-yellow-600 text-white rounded-xl font-black text-xs uppercase shadow-xl hover:bg-yellow-700 transition" data-key="btn_submit_final">Submit Design</button>
            </div>
        </div>
    </div>

    <script>
        let currentLang = 'en';

        // --- 12 MOCKED REFERRAL CASES ---
        const mockReferredCases = [
            { id: 'TW-001', practitioner: 'Dr. Ryan Chiang (Harmony Clinic)', data: [1, 1, 1, 1, 0, 0], status: 'Ready' },
            { id: 'TW-002', practitioner: 'Dr. Clement Lin (Harmony Clinic)', data: [1, 1, 1, 1, 1, 1], status: 'Ready' },
            { id: 'TW-003', practitioner: 'Dr. Sarah Lin (Bright Dental)', data: [1, 1, 1, 0, 0, 0], status: 'Incomplete' },
            { id: 'TW-004', practitioner: 'Dr. Kevin Chen (Kevin Dental)', data: [1, 0, 1, 1, 0, 0], status: 'Incomplete' },
            { id: 'TW-005', practitioner: 'Dr. Mei-Ling Wu (Apex Care)', data: [1, 1, 1, 1, 1, 1], status: 'Ready' },
            { id: 'TW-006', practitioner: 'Dr. Robert Wang (Zenith Clinic)', data: [0, 0, 1, 1, 0, 0], status: 'Incomplete' },
            { id: 'TW-007', practitioner: 'Dr. Linda Su (Family Ortho)', data: [1, 1, 0, 1, 1, 1], status: 'Ready' },
            { id: 'TW-008', practitioner: 'Dr. Alice Chang (Alice Dental)', data: [1, 1, 1, 1, 1, 0], status: 'Incomplete' },
            { id: 'TW-009', practitioner: 'Dr. Jason Liu (Harmony Clinic)', data: [1, 1, 1, 1, 1, 1], status: 'Ready' },
            { id: 'TW-010', practitioner: 'Dr. Peter Tseng (Taipei Center)', data: [1, 0, 1, 0, 1, 0], status: 'Incomplete' },
            { id: 'TW-011', practitioner: 'Dr. Emily Yang (Care First)', data: [1, 1, 1, 1, 0, 1], status: 'Ready' },
            { id: 'TW-012', practitioner: 'Dr. David Hsu (Hsu Ortho)', data: [1, 1, 1, 1, 1, 1], status: 'Ready' }
        ];

        const translations = {
            'en': {
                'header_title': 'Professional Consultant Dashboard',
                'logout_link': '← Log Out / Portal',
                'pdpa_banner_title': 'PDPA Compliance & Pseudonymization Enforced',
                'pdpa_banner_text_1': 'All cases displayed are **pseudonymized** (Client ID only) to protect identity.',
                'pdpa_banner_text_2': 'Access requires: (1) Written Patient Consent, (2) Executed DPA.',
                'search_title': 'Referred Case Tracker',
                'search_placeholder': 'Search by ID or practitioner...',
                'btn_search': 'Search',
                'col_id': 'Client ID',
                'col_doc_clinic': 'Referring Doctor / Clinic',
                'col_ceph': 'Lateral Ceph S+',
                'col_schwarz': 'Models (Schwartz)',
                'col_photos': 'Dental+Facial Photos',
                'col_cbct': 'CBCT Imaging',
                'col_rx': 'RX to STA Lab',
                'col_sta': 'STA Delivery Date',
                'col_status': 'Action',
                'case_details_title': 'Case Review: Client ID',
                'btn_submit_opinion_header': 'Submit Professional Opinion',
                'case_tab_diagnostics': 'Diagnostic Inputs',
                'case_tab_progress': 'Progress Tracker',
                'case_tab_history': 'Consultation History',
                'diagnostics_title': 'Shared Diagnostic Inputs',
                'cbct_title': 'CB CT Scan (Airway)',
                'intraoral_title': '3D Intra-Oral Scan (Teeth)',
                'ceph_title': 'Lateral Cephalometric Analysis',
                'analysis_ready': 'Analysis ready',
                'btn_view_case': 'Review Case →',
                'viewing_photos': 'Viewing photos from',
                'btn_submit_final': 'Submit Final Design',
                'btn_cancel': 'Cancel',
                'toggle_text': '中文'
            },
            'zh': {
                'header_title': '專業顧問儀表板',
                'logout_link': '← 登出 / 入口網站',
                'pdpa_banner_title': 'PDPA 合規與假名化強制執行',
                'pdpa_banner_text_1': '所有顯示的病例均已**假名化**（僅顯示 ID）以保護身份。',
                'pdpa_banner_text_2': '訪問要求: (1) 患者書面同意, (2) 已簽署 DPA。',
                'search_title': '病例轉介追蹤總表',
                'search_placeholder': '搜尋 ID 或執業醫師...',
                'btn_search': '搜尋',
                'col_id': '客戶 ID',
                'col_doc_clinic': '轉介醫師 / 診所',
                'col_ceph': '側位頭影 S+',
                'col_schwarz': '模型 (Schwartz)',
                'col_photos': '牙齒+面部照片',
                'col_cbct': 'CBCT 影像',
                'col_rx': '技工單 (STA)',
                'col_sta': 'STA 交付',
                'col_status': '操作',
                'case_details_title': '病例審閱: 客戶 ID',
                'btn_submit_opinion_header': '提交專業意見',
                'case_tab_diagnostics': '診斷輸入',
                'case_tab_progress': '進度追踪器',
                'case_tab_history': '會診歷史記錄',
                'diagnostics_title': '共享診斷輸入',
                'cbct_title': '錐束CT掃描 (氣道)',
                'intraoral_title': '3D 口內掃描 (牙齒)',
                'ceph_title': '側位頭影測量分析',
                'analysis_ready': '分析已準備就緒',
                'btn_view_case': '審閱病例 →',
                'viewing_photos': '查看照片來自',
                'btn_submit_final': '提交最終設計',
                'btn_cancel': '取消',
                'toggle_text': 'English'
            }
        };

        function renderTracker() {
            const body = document.getElementById('case-tracker-body');
            body.innerHTML = mockReferredCases.map(c => `
                <tr class="hover:bg-gray-50 cursor-pointer transition-colors" onclick="viewCase('${c.id}')">
                    <td class="p-4 font-bold text-gray-800">ID: ${c.id}</td>
                    <td class="p-4 text-[10px] font-bold text-gray-500 uppercase tracking-tight">${c.practitioner}</td>
                    ${c.data.map(val => `
                        <td class="text-center p-4">
                            <i class="fa-solid ${val ? 'fa-circle-check text-blue-500' : 'fa-circle text-gray-200'} text-lg"></i>
                        </td>
                    `).join('')}
                    <td class="p-4 text-right pr-4">
                        <span class="text-[10px] font-black text-blue-600 uppercase underline">${translations[currentLang].btn_view_case}</span>
                    </td>
                </tr>
            `).join('');
        }

        function updateText() {
            const data = translations[currentLang];
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (data[key]) el.textContent = data[key];
            });
            document.getElementById('lang-toggle').textContent = data.toggle_text;
            renderTracker();
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'zh' : 'en';
            updateText();
        }

        function switchCaseTab(tabId) {
            document.querySelectorAll('.case-tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector(`[onclick="switchCaseTab('${tabId}')"]`);
            if (btn) btn.classList.add('active');
        }

        function viewCase(caseId) {
            document.getElementById('client-id-display').textContent = caseId;
            document.getElementById('case-details-view').classList.remove('hidden');
            switchCaseTab('case-diagnostics');
            document.getElementById('case-details-view').scrollIntoView({ behavior: 'smooth' });
        }

        function openSubmitModal() {
            document.getElementById('opinion-modal').classList.remove('hidden');
            document.getElementById('opinion-client-id').textContent = document.getElementById('client-id-display').textContent;
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function submitOpinion() {
            alert("Design transmitted to Practitioner. Case " + document.getElementById('opinion-client-id').textContent + " archived.");
            closeModal('opinion-modal');
        }

        function updateConsultantComparisonView(val) {
            const grid = document.getElementById('photo-comparison-grid');
            grid.innerHTML = `<div class="p-4 bg-gray-50 border rounded-xl flex items-center justify-center h-48 text-[10px] font-black text-gray-300 uppercase tracking-widest">Pseudonymized Imaging: Phase ${val}</div>`;
        }

        document.addEventListener('DOMContentLoaded', updateText);
    </script>
</body>
</html>
