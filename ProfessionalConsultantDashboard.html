<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMD Remote Specialist Dashboard | The Brain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .bg-gray-gradient { background-image: linear-gradient(to right, #475569, #1e293b); }
        .section-card { background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        
        .nav-button { padding: 0.75rem 1rem; text-align: left; font-weight: 600; color: #64748b; border-radius: 0.5rem; transition: all 0.2s ease; width: 100%; display: flex; align-items: center; gap: 10px; }
        .nav-button:hover { background-color: #f1f5f9; color: #1e293b; }
        .nav-button.active { background-color: #f1f5f9; color: #1e293b; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); border-right: 3px solid #1e293b; }

        .tracker-header { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; color: #94a3b8; padding: 1rem 0.5rem; border-bottom: 2px solid #f1f5f9; }
        .ageing-pill { font-size: 0.65rem; padding: 0.1rem 0.4rem; border-radius: 4px; font-weight: 700; display: inline-block; }
        .ageing-done { background-color: #f1f5f9; color: #94a3b8; }
        .ageing-active { background-color: #f1f5f9; color: #1e293b; border: 1px solid #cbd5e1; }
        
        .sub-nav-btn { padding: 0.6rem 1rem; font-size: 0.8rem; font-weight: 600; color: #64748b; border-radius: 0.5rem; transition: all 0.2s; display: flex; align-items: center; gap: 8px; width: 100%; text-align: left; border-left: 3px solid transparent; }
        .sub-nav-btn:hover { background-color: #f8fafc; color: #1e293b; }
        .sub-nav-btn.active { background-color: #f8fafc; color: #1e293b; border-left: 3px solid #1e293b; font-weight: 700; }

        .chat-bubble { padding: 0.75rem 1rem; border-radius: 1rem; max-width: 85%; font-size: 0.85rem; line-height: 1.5; margin-bottom: 0.75rem; }
        .chat-amd { background-color: #ecfdf5; align-self: flex-start; border-bottom-left-radius: 0; border: 1px solid #d1fae5; }
        .chat-specialist { background-color: #f1f5f9; align-self: flex-end; border-bottom-right-radius: 0; border: 1px solid #cbd5e1; }

        .scan-card { background: #ffffff; border-radius: 0.75rem; border: 1px solid #e2e8f0; overflow: hidden; transition: all 0.2s; cursor: pointer; }
        .scan-card:hover { border-color: #1e293b; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .recording-pulse { animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="antialiased">

    <div class="min-h-screen">
        <header class="bg-gray-gradient shadow-sm sticky top-0 z-50">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                 <div class="flex items-center gap-3">
                     <svg width="32" height="32" viewBox="0 0 100 100" class="fill-white">
                        <path d="M70,20 C60,10 40,10 30,20 C20,30 15,50 20,65 C22,70 25,75 30,78 C35,82 45,85 55,85 C65,85 75,80 80,70 C85,60 85,30 70,20 Z M50,15 C65,15 75,25 78,40 C80,50 80,65 72,78 C65,85 50,85 40,78 C35,74 30,65 30,50 C30,35 40,15 50,15 Z" opacity="0.4"/>
                        <path d="M45,45 Q50,40 55,45 Q60,50 55,65 Q50,75 45,65 Q40,55 45,45 Z" fill="#94a3b8"/>
                        <path d="M35,65 Q40,75 55,75 Q70,75 75,65" stroke="white" stroke-width="4" fill="none" stroke-linecap="round"/>
                     </svg>
                     <h1 class="text-xl font-bold text-white tracking-tight" data-key="header_title">AMD Specialist Dashboard</h1>
                 </div>
                <div class="flex items-center space-x-4">
                    <button id="lang-toggle" onclick="toggleLanguage()" class="py-1.5 px-4 rounded-full bg-white/10 text-white font-semibold text-xs border border-white/20 hover:bg-white/20 transition">中文</button>
                    <div class="h-8 w-8 rounded-full bg-slate-800 flex items-center justify-center text-white text-xs font-bold border border-slate-400">FL</div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            
            <!-- PDPA Compliance -->
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-8 rounded-r-xl flex items-center gap-4 shadow-sm">
                <i class="fa-solid fa-user-shield text-blue-600 text-xl"></i>
                <div>
                    <p class="text-[10px] font-black text-blue-800 uppercase tracking-widest">Pseudonymization Enforced</p>
                    <p class="text-xs text-blue-700 font-medium">Remote access is restricted to anonymized Case IDs. International data transfer protocols are active.</p>
                </div>
            </div>

            <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                
                <div class="lg:col-span-1 mb-8">
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 sticky top-24">
                        <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4 px-2">Expert Review Portal</h3>
                        <nav class="flex flex-col space-y-1">
                            <button id="nav-overview" class="nav-button active" onclick="switchMainPane('overview')">
                                <i class="fa-solid fa-folder-tree w-4"></i> Case Queue
                            </button>
                            <button id="nav-archive" class="nav-button" onclick="switchMainPane('archive')">
                                <i class="fa-solid fa-box-archive w-4"></i> Review Archive
                            </button>
                        </nav>
                        <div class="mt-8 p-4 bg-slate-50 rounded-lg border border-slate-100">
                            <p class="text-[9px] font-bold text-slate-400 uppercase mb-1">Queue Status</p>
                            <p class="text-sm font-bold text-slate-700">4 Urgent Reviews Pending</p>
                        </div>
                    </div>
                </div>

                <div id="content-area" class="lg:col-span-3 space-y-8">
                    
                    <!-- 1. Case Queue -->
                    <div id="pane-overview" class="main-pane space-y-6">
                        <h2 class="text-2xl font-black text-slate-800 tracking-tight" data-key="registry_title">Expert Analysis Queue</h2>
                        <div class="section-card overflow-hidden !p-0 border border-slate-100">
                            <div class="overflow-x-auto no-scrollbar">
                                <table class="min-w-full divide-y divide-slate-100">
                                    <thead class="bg-slate-50/50">
                                        <tr>
                                            <th class="tracker-header text-left pl-6" data-key="col_id">Case ID</th>
                                            <th class="tracker-header text-left">Referring Dr / Clinic</th>
                                            <th class="tracker-header text-center">Payment Status</th>
                                            <th class="tracker-header text-center">Scan Status</th>
                                            <th class="tracker-header text-right pr-6" data-key="col_ageing">Queue Age</th>
                                        </tr>
                                    </thead>
                                    <tbody id="case-tracker-body" class="bg-white divide-y divide-slate-100 text-sm"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Review Archive (Historical) -->
                    <div id="pane-archive" class="main-pane hidden space-y-6">
                        <h2 class="text-2xl font-black text-slate-800 tracking-tight">Review Archive</h2>
                        <div class="section-card border-slate-100">
                            <div class="relative mb-6">
                                <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                                <input type="text" placeholder="Search historical Case IDs..." class="w-full pl-11 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none text-sm">
                            </div>
                            <div class="space-y-3" id="archive-list">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- 3. Detailed Case Review Workspace -->
                    <div id="pane-case-review" class="main-pane hidden space-y-6">
                        <div class="flex items-center justify-between gap-4">
                            <div class="flex items-center gap-4">
                                <button onclick="switchMainPane('overview')" class="h-10 w-10 rounded-full border border-slate-200 flex items-center justify-center text-slate-400 hover:text-slate-600 transition">
                                    <i class="fa-solid fa-arrow-left"></i>
                                </button>
                                <div>
                                    <h2 id="detail-id" class="text-2xl font-black text-slate-900 leading-none mb-1">--</h2>
                                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">
                                        Status: <span class="text-amber-600 font-bold" id="detail-status">--</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="md:w-64 flex-shrink-0">
                                <div class="bg-white p-3 rounded-xl border border-slate-100 space-y-1">
                                    <button class="sub-nav-btn active" onclick="switchDetailTab('diagnostics')"><i class="fa-solid fa-microscope w-4"></i> Scans, Analysis & Reports</button>
                                    <button class="sub-nav-btn" onclick="switchDetailTab('prescription')"><i class="fa-solid fa-file-signature w-4"></i> Airway Prescription</button>
                                    <button class="sub-nav-btn" onclick="switchDetailTab('analysis')"><i class="fa-solid fa-chart-pie w-4"></i> Expert Analysis</button>
                                    <button class="sub-nav-btn" onclick="switchDetailTab('design')"><i class="fa-solid fa-compass-drafting w-4"></i> Design Specifications</button>
                                    <button class="sub-nav-btn" onclick="switchDetailTab('videos')"><i class="fa-solid fa-video w-4"></i> Coaching Review</button>
                                    <button class="sub-nav-btn" onclick="switchDetailTab('spec-chat')"><i class="fa-solid fa-user-secret w-4"></i> Clinical Collaboration</button>
                                </div>
                            </div>

                            <div class="flex-1 min-w-0 space-y-6">
                                <!-- Vitals Package -->
                                <div id="tab-diagnostics" class="detail-tab space-y-6">
                                    <div class="section-card">
                                        <h3 class="font-bold text-slate-800 mb-4 uppercase text-xs tracking-widest">Scans, Analysis & Reports</h3>
                                        
                                        <!-- Scans -->
                                        <h4 class="text-[10px] font-black text-slate-400 uppercase mb-2">Clinical Imaging</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" id="scan-grid"></div>

                                        <!-- Reports -->
                                        <h4 class="text-[10px] font-black text-slate-400 uppercase mb-2">Medical Reports</h4>
                                        <div class="space-y-2">
                                            <div class="p-2 border rounded flex justify-between text-xs bg-slate-50"><span>Blood Panel (CBC) - 2025/11/15</span><button class="text-blue-600 font-bold hover:underline">Download</button></div>
                                            <div class="p-2 border rounded flex justify-between text-xs bg-slate-50"><span>Liver Function - 2025/11/15</span><button class="text-blue-600 font-bold hover:underline">Download</button></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Expert Analysis Tab (New) -->
                                <div id="tab-analysis" class="detail-tab hidden space-y-6">
                                    <div class="section-card border-t-8 border-cyan-500">
                                        <div class="flex justify-between items-center mb-6">
                                             <h3 class="font-bold text-slate-800 uppercase text-xs">Analysis Workflows</h3>
                                             <div class="px-3 py-1 bg-green-100 text-green-700 text-[10px] font-bold rounded uppercase hidden" id="payment-verified-badge">Payment Verified</div>
                                        </div>
                                        
                                        <div class="space-y-4">
                                            <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl flex justify-between items-center">
                                                <div>
                                                    <p class="font-bold text-sm text-slate-800">Sassouni Plus Analysis</p>
                                                    <p class="text-xs text-slate-500">Status: <span class="font-bold" id="sassouni-status">Pending Request</span></p>
                                                </div>
                                                <button onclick="requestAnalysis('Sassouni')" class="px-3 py-1.5 bg-cyan-600 text-white text-[10px] font-bold rounded uppercase shadow hover:bg-cyan-700">Request Analysis</button>
                                            </div>
                                            
                                            <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl flex justify-between items-center">
                                                <div>
                                                    <p class="font-bold text-sm text-slate-800">Schwartz Model Analysis</p>
                                                    <p class="text-xs text-slate-500">Status: <span class="font-bold" id="schwartz-status">Pending Request</span></p>
                                                </div>
                                                <button onclick="requestAnalysis('Schwartz')" class="px-3 py-1.5 bg-cyan-600 text-white text-[10px] font-bold rounded uppercase shadow hover:bg-cyan-700">Request Analysis</button>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-6 p-4 bg-yellow-50 border border-yellow-100 rounded-xl hidden" id="analysis-results">
                                            <h4 class="font-bold text-xs text-yellow-800 mb-2 uppercase">Analysis Results Received</h4>
                                            <p class="text-xs text-slate-700 mb-1"><strong>Sassouni:</strong> Class II Skeletal, high FMA (28°). </p>
                                            <p class="text-xs text-slate-700"><strong>Schwartz:</strong> Maxillary transverse deficiency of 6mm at first molars.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Airway Prescription AI Hub -->
                                <div id="tab-prescription" class="detail-tab hidden space-y-6">
                                    <div class="section-card border-t-8 border-indigo-500">
                                        <div class="flex justify-between items-center mb-6">
                                            <h3 class="font-bold text-slate-800 uppercase text-xs">Expert Assessment (Voice-to-AI)</h3>
                                            <div class="flex gap-2">
                                                <button onclick="toggleRecording()" id="record-btn" class="px-4 py-1.5 bg-red-600 text-white text-[10px] font-black rounded-lg uppercase shadow-lg transition hover:scale-105"><i class="fa-solid fa-microphone mr-2"></i> Record</button>
                                                <button onclick="generateAIPrescription()" class="px-4 py-1.5 bg-indigo-600 text-white text-[10px] font-black rounded-lg uppercase shadow-lg transition hover:bg-indigo-700">Run AI Agent</button>
                                            </div>
                                        </div>
                                        
                                        <!-- Search Past Cases -->
                                        <div class="mb-6 bg-slate-50 p-4 rounded-xl border border-slate-200">
                                            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-2 block">Search Past Cases by Symptom (Benchmark)</label>
                                            <div class="flex gap-2">
                                                <input type="text" placeholder="e.g. 'Erectile dysfunction', 'Back ache', 'poor sleep'" class="flex-1 p-2 border rounded-lg text-xs">
                                                <button class="px-3 py-2 bg-slate-600 text-white rounded-lg text-xs font-bold uppercase hover:bg-slate-700">Search</button>
                                            </div>
                                            <div class="mt-3 flex gap-2 overflow-x-auto no-scrollbar">
                                                <span class="px-2 py-1 bg-white border rounded text-[9px] font-bold text-slate-500 cursor-pointer hover:border-indigo-400">TW-402 (Sleep)</span>
                                                <span class="px-2 py-1 bg-white border rounded text-[9px] font-bold text-slate-500 cursor-pointer hover:border-indigo-400">TW-105 (Back Ache)</span>
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                            <div class="space-y-2"><label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Select Report Template</label><select id="report-template" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500"><option value="airway">Template 1: Airway Volume Deficiency</option><option value="arch">Template 2: Maxillary Arch Constriction</option></select></div>
                                            <div class="space-y-2">
                                                <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Selected Benchmarks</label>
                                                <div class="p-3 bg-white border border-slate-200 rounded-xl text-xs text-indigo-600 font-bold">Case TW-402</div>
                                            </div>
                                        </div>

                                        <div id="ai-draft-box" class="p-4 bg-slate-50 border border-slate-100 rounded-xl mb-6"><p class="text-[9px] font-black text-indigo-600 uppercase mb-2">AI Whisper Transcript</p><p id="transcript-text" class="text-sm italic text-slate-600 leading-relaxed">"Analysis indicates critical velopharyngeal narrowing...Intermolar width currently 40.0mm."</p></div>
                                        
                                        <div class="space-y-4">
                                            <div><label class="text-[10px] font-black text-slate-400 uppercase mb-2 block">Case Notes for local AMD</label><textarea id="amd-notes" class="w-full p-4 bg-slate-50 border border-slate-100 rounded-xl text-sm outline-none" rows="3"></textarea></div>
                                            <div><label class="text-[10px] font-black text-slate-400 uppercase mb-2 block">Clinical Milestone Summary</label><textarea id="clinical-summary" class="w-full p-4 bg-slate-50 border border-slate-100 rounded-xl text-sm outline-none" rows="3"></textarea></div>
                                            
                                            <!-- Nutrition Plan -->
                                            <div class="bg-green-50/50 p-4 rounded-xl border border-green-100">
                                                <label class="text-[10px] font-black text-green-700 uppercase mb-2 block">Prescribed Nutrition Plan</label>
                                                <textarea id="nutrition-plan" class="w-full p-4 bg-white border border-green-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-green-500" rows="3" placeholder="Specify supplements (Bone Broth, Magnesium) and dietary restrictions..."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Design Specs -->
                                <div id="tab-design" class="detail-tab hidden space-y-6">
                                    <div class="section-card border-t-8 border-amber-500">
                                        <div class="flex justify-between items-center mb-6"><h3 class="font-bold text-slate-800 uppercase text-xs">STA Lab Fabrication Details</h3><button onclick="pushToLab()" class="bg-slate-900 text-white px-4 py-2 rounded text-[10px] font-bold uppercase tracking-widest hover:bg-black transition shadow-lg">Issue Design Specs to Lab</button></div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                            <div class="space-y-4"><div><label class="text-[10px] font-black text-amber-600 uppercase mb-1 block">Appliance Setting Protocol</label><input type="text" id="design-protocol" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg text-sm font-bold" value="2 Turns / Bi-weekly (0.50mm)"></div><div><label class="text-[10px] font-black text-teal-600 uppercase mb-1 block">Bio-Support Requirements</label><textarea id="design-bio" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg text-sm italic" rows="3" placeholder="e.g. Mandatory bone broth loading phase..."></textarea></div></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Coaching Review (View Only) -->
                                <div id="tab-videos" class="detail-tab hidden space-y-6">
                                    <div class="section-card"><h3 class="font-bold text-slate-800 mb-4 uppercase text-xs">ATC Shared Progress Review</h3><div id="video-review-list" class="space-y-4"></div></div>
                                </div>

                                <!-- Clinical Collaboration (AMD-Spec Only) -->
                                <div id="tab-spec-chat" class="detail-tab hidden space-y-6">
                                    <div class="section-card flex flex-col h-[500px] border-l-4 border-slate-500">
                                        <div class="flex justify-between items-center mb-4 border-b pb-2">
                                            <h3 class="font-bold text-slate-800 uppercase text-xs">Private Clinical Collaboration</h3>
                                            <span class="text-[10px] bg-red-100 text-red-700 px-2 py-0.5 rounded font-bold uppercase"><i class="fa-solid fa-lock mr-1"></i> AMD + Specialist Only</span>
                                        </div>
                                        <div class="flex-1 overflow-y-auto space-y-4 p-2 flex flex-col no-scrollbar">
                                            <div class="chat-bubble chat-amd"><p class="text-[9px] font-black uppercase mb-1">Dr. Ryan</p><p class="text-sm">Verified molar rotation. No interference.</p></div>
                                            <div class="chat-bubble chat-specialist"><p class="text-[9px] font-black uppercase mb-1">You</p><p class="text-sm">Acknowledged. Proceed with expansion.</p></div>
                                        </div>
                                        <div class="mt-4 flex gap-2 pt-4 border-t">
                                            <input type="text" placeholder="Private message to AMD..." class="flex-1 px-4 py-2 border rounded-xl outline-none text-sm">
                                            <button class="bg-slate-700 text-white px-4 rounded-xl"><i class="fa-solid fa-paper-plane"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <!-- Reject Modal -->
    <div id="reject-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-2xl">
            <h3 class="text-xl font-black text-red-600 mb-2 uppercase tracking-tight">Reject Scan Data</h3>
            <div class="space-y-4">
                <div><label class="text-[10px] font-black text-slate-400 uppercase block mb-1">Rejection Instruction</label><textarea id="reject-instruction" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none h-32" placeholder="e.g. Blurry resolution. Please re-capture CBCT..."></textarea></div>
            </div>
            <div class="flex gap-4 mt-8"><button onclick="closeModal('reject-modal')" class="flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-black text-xs uppercase">Cancel</button><button onclick="confirmReject()" class="flex-1 py-3 bg-red-600 text-white rounded-xl font-black text-xs uppercase shadow-xl hover:bg-red-700 transition">Send Rejection</button></div>
        </div>
    </div>

    <script>
        let currentLang = 'en';
        let isRecording = false;
        let activeRejectScan = null;

        const translations = {
            en: { header_title: "AMD Specialist Dashboard", registry_title: "Expert Analysis Queue", col_id: "Case ID", col_ceph: "S+ Trace", col_schwarz: "Schwartz", col_cbct: "CBCT", col_ageing: "Queue / Total Age" },
            zh: { header_title: "AMD 遠程專科醫生門戶", registry_title: "專家審核隊列", col_id: "病例 ID", col_ceph: "S+ 追踪", col_schwarz: "模型分析", col_cbct: "氣道掃描", col_ageing: "隊列時程" }
        };

        const mockCases = [
            { id: "TW-001", doctor: "Dr. Ryan Chiang", clinic: "Harmony Taipei", data: [1, 1, 1, 0], queueAge: "2d", totalAge: "12d", payment: "Paid", motivation: "Fatigue Elimination", pains: "Apnea, Snoring", sharedVideos: [{date:"Jan 12", transcript: "Molar pressure noted."}] },
            { id: "TW-014", doctor: "Dr. Peter Tseng", clinic: "Legacy Airway", data: [1, 0, 1, 0], queueAge: "4d", totalAge: "8d", payment: "Pending", motivation: "Headaches", pains: "Migraines", sharedVideos: [] },
            { id: "TW-004", doctor: "Dr. Sarah Lin", clinic: "Bright Dental", data: [1, 1, 1, 1], queueAge: "1d", totalAge: "142d", payment: "Paid", motivation: "Structure", pains: "Mouth breathing", sharedVideos: [] }
        ];

        const archivedCases = [
            { id: "TW-008", date: "Dec 2025", clinic: "Zen Dental", result: "Protocol Issued" },
            { id: "TW-011", date: "Nov 2025", clinic: "Legacy Airway", result: "Protocol Issued" }
        ];

        function renderQueue() {
            const body = document.getElementById('case-tracker-body');
            if(!body) return;
            body.innerHTML = mockCases.map(c => `
                <tr class="hover:bg-slate-50 cursor-pointer transition-colors" onclick="selectCase('${c.id}')">
                    <td class="px-6 py-4 font-black text-slate-800 text-xs">${c.id}</td>
                    <td class="px-6 py-4"><span class="font-bold text-slate-800 text-xs">${c.doctor}</span><br><span class="text-[9px] font-black text-slate-400 uppercase">${c.clinic}</span></td>
                    <td class="text-center px-4 py-4 text-xs font-bold ${c.payment === 'Paid' ? 'text-green-600' : 'text-amber-500'}">${c.payment}</td>
                    <td class="text-center px-4 py-4"><span class="text-[9px] font-bold text-slate-500">Review Ready</span></td>
                    <td class="px-6 py-4 text-right"><span class="text-xs font-black text-indigo-600">${c.queueAge} / ${c.totalAge}</span></td>
                </tr>`).join('');
            
            const arch = document.getElementById('archive-list');
            if(arch) arch.innerHTML = archivedCases.map(a => `<div class="p-4 bg-slate-50 border border-slate-200 rounded-xl flex justify-between items-center"><div><p class="font-bold text-slate-800 text-sm">${a.id}</p><p class="text-[10px] text-slate-500 uppercase">${a.clinic} • ${a.date}</p></div><button class="text-xs font-bold text-slate-600 hover:text-slate-900 underline">View Record</button></div>`).join('');
        }

        function selectCase(id) {
            const c = mockCases.find(x => x.id === id);
            if(!c) return;
            const detailId = document.getElementById('detail-id');
            if(detailId) detailId.innerText = c.id;
            
            const detailStatus = document.getElementById('detail-status');
            if(detailStatus) detailStatus.innerHTML = c.payment === 'Paid' ? '<span class="text-green-600">Payment Verified</span>' : '<span class="text-amber-600">Payment Pending</span>';

            if(c.payment === 'Paid') {
                const badge = document.getElementById('payment-verified-badge');
                if(badge) badge.classList.remove('hidden');
            }

            const scanGrid = document.getElementById('scan-grid');
            if(scanGrid) {
                const scans = [
                    { name: "Lateral Ceph X-Ray", status: "Verified", icon: "fa-x-ray", date: "2025/12/10" }, 
                    { name: "CBCT Airway Images", status: "Verified", icon: "fa-cube", date: "2025/12/10" }, 
                    { name: "3D Intra-Oral Scan", status: "Verified", icon: "fa-teeth", date: "2025/12/10" }, 
                    { name: "Clinical Photos", status: "Verified", icon: "fa-camera", date: "2025/12/10" }
                ];
                scanGrid.innerHTML = scans.map(s => `
                    <div class="scan-card">
                        <div class="p-3 border-b flex justify-between items-center bg-slate-50"><span class="text-[9px] font-black uppercase text-slate-500">Capture: ${s.date}</span><select class="text-[8px] border bg-white rounded"><option>Current</option><option>History</option></select></div>
                        <div class="scan-preview-placeholder"><i class="fa-solid ${s.icon} text-slate-300 text-4xl"></i><div class="absolute top-2 left-2 px-2 py-0.5 bg-black/60 text-white text-[8px] font-bold rounded uppercase">${s.name}</div></div>
                        <div class="p-3 border-t flex gap-2"><button class="flex-1 py-1.5 bg-slate-50 text-[9px] font-black rounded uppercase border hover:bg-white">View</button><button onclick="openRejectModal('${s.name}')" class="px-3 py-1.5 bg-red-50 text-red-600 text-[9px] font-black rounded uppercase">Reject</button></div>
                    </div>`).join('');
            }

            const vList = document.getElementById('video-review-list');
            if(vList) {
                vList.innerHTML = c.sharedVideos.length ? c.sharedVideos.map(v => `
                    <div class="p-4 bg-slate-50 border rounded-xl flex gap-6">
                        <div class="w-32 aspect-video bg-slate-900 rounded flex items-center justify-center"><i class="fa-solid fa-play text-white opacity-30"></i></div>
                        <div class="flex-1">
                            <p class="text-[9px] font-black text-slate-400 uppercase mb-1">Shared by ATC (${v.date})</p>
                            <p class="text-sm italic text-slate-600 mb-3">"${v.transcript}"</p>
                            <div class="text-xs text-slate-400 italic">View Only - Reply via Private Chat</div>
                        </div>
                    </div>
                `).join('') : '<div class="text-center py-8 text-slate-300 text-xs italic">No behavioral videos shared.</div>';
            }

            switchMainPane('case-review');
        }
        
        function requestAnalysis(type) {
            alert(`Request for ${type} Analysis sent to partner lab.`);
            document.getElementById(`${type.toLowerCase()}-status`).innerText = "Processing (Sent)";
            document.getElementById(`${type.toLowerCase()}-status`).classList.add('text-amber-600');
            
            // Mock receiving results
            setTimeout(() => {
                document.getElementById('analysis-results').classList.remove('hidden');
                document.getElementById(`${type.toLowerCase()}-status`).innerText = "Complete";
                document.getElementById(`${type.toLowerCase()}-status`).classList.replace('text-amber-600', 'text-green-600');
            }, 1500);
        }

        function generateAIPrescription() {
            const template = document.getElementById('report-template').value;
            const nutrition = document.getElementById('nutrition-plan').value || "Bone broth daily.";
            document.getElementById('amd-notes').value = `Expert Assessment Finalized (${template.toUpperCase()}). Nutrition: ${nutrition}. Case displays velopharyngeal restriction.`;
            document.getElementById('clinical-summary').value = "Target intermolar width: 44.5mm. Bi-weekly turns: 2 turns (0.50mm).";
            alert("AI Agent (Claude) mapping assessment notes to template.");
        }

        function toggleRecording() {
            const btn = document.getElementById('record-btn');
            isRecording = !isRecording;
            btn.innerHTML = isRecording ? '<i class="fa-solid fa-stop mr-2"></i> Stop' : '<i class="fa-solid fa-microphone mr-2"></i> Record Assessment';
            btn.classList.toggle('recording-pulse', isRecording);
        }

        function pushToLab() { alert("Design Specs authorized. Issued to Manufacturing Lab."); }

        function switchMainPane(id) {
            const target = document.getElementById(`pane-${id}`);
            if(!target) return;
            document.querySelectorAll('.main-pane').forEach(p => p.classList.add('hidden'));
            target.classList.remove('hidden');
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById(`nav-${id}`);
            if(btn) btn.classList.add('active');
        }

        function switchDetailTab(id) {
            const target = document.getElementById(`tab-${id}`);
            if(!target) return;
            document.querySelectorAll('.detail-tab').forEach(t => t.classList.add('hidden'));
            target.classList.remove('hidden');
            document.querySelectorAll('.sub-nav-btn').forEach(b => b.classList.remove('active'));
            const clickedBtn = Array.from(document.querySelectorAll('.sub-nav-btn')).find(btn => btn.getAttribute('onclick')?.includes(`'${id}'`));
            if(clickedBtn) clickedBtn.classList.add('active');
        }

        function toggleLanguage() { currentLang = currentLang === 'en' ? 'zh' : 'en'; updateText(); }
        function updateText() {
            const data = translations[currentLang];
            document.querySelectorAll('[data-key]').forEach(el => { const k = el.getAttribute('data-key'); if(data[k]) el.textContent = data[k]; });
            document.getElementById('lang-toggle').textContent = currentLang === 'en' ? '中文' : 'English';
            renderQueue();
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function confirmReject() { alert("Scan rejected. AMD & ATC notified."); closeModal('reject-modal'); }
        function openRejectModal(name) { activeRejectScan = name; document.getElementById('reject-modal').classList.remove('hidden'); }

        window.onload = updateText;
    </script>
</body>
</html>
