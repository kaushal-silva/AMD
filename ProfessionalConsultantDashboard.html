<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMD Professional Consultant Dashboard | Case Review</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .bg-gray-gradient {
            background-image: linear-gradient(to right, #4b5563, #374151); /* Gray 600 to 700 */
        }
        .section-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .nav-button {
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #4b5563;
            border-radius: 0.5rem;
            transition: all 0.15s ease;
        }
        .nav-button.active {
            background-color: #f3f4f6;
            color: #1f2937;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border-left: 3px solid #374151;
        }
        .nav-button:not(.active):hover {
            background-color: #e5e7eb;
        }
        .alert-red {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            color: #b91c1c;
        }
        .chat-specialist {
            background-color: #fef3c7; /* Amber 100 */
            align-self: flex-end;
        }
        .chat-dentist {
            background-color: #e6fffa; /* Teal 100 */
            align-self: flex-start;
        }
        .priority-high {
             @apply bg-red-100 text-red-700 font-semibold;
        }
        .priority-normal {
             @apply bg-yellow-100 text-yellow-700 font-semibold;
        }
        /* Custom modal animation */
        .modal-fade-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-fade-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 200ms ease-out, transform 200ms ease-out;
        }
    </style>
</head>
<body>

    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-gray-gradient shadow-md">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                <h1 id="header-title" class="text-3xl font-bold text-white" data-key="header_title">Professional Consultant Dashboard</h1>
                <div class="flex items-center space-x-4">
                    <!-- Language Toggle Button -->
                    <button id="lang-toggle" onclick="toggleLanguage()" class="py-1 px-3 rounded-full bg-white text-gray-700 border border-gray-500 hover:bg-gray-100 transition duration-150 font-semibold text-sm shadow">
                        <!-- Text updated by JavaScript -->
                    </button>
                    <a href="index.html" class="text-sm font-medium text-gray-200 hover:text-white" data-key="logout_link">← Log Out / Portal</a>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            
            <!-- PDPA Compliance & Pseudonymization Enforcement Banner -->
            <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-800 p-4 mb-8 rounded-lg shadow-md" role="alert">
                <p class="font-bold text-lg mb-2" data-key="pdpa_banner_title">PDPA Compliance & Pseudonymization Enforced</p>
                <p class="text-sm" data-key="pdpa_banner_text_1">
                    All cases displayed are **pseudonymized** (e.g., Client ID only) to protect patient identity. INV files require secure handling.
                </p>
                <p class="text-sm mt-1 font-semibold" data-key="pdpa_banner_text_2">
                    Access confirms: (1) Patient Consent, (2) Executed DPA, (3) Data is Pseudonymized.
                </p>
            </div>

            <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                
                <!-- LEFT COLUMN: Case Queue and Navigation (1/4) -->
                <div class="lg:col-span-1 mb-8 lg:mb-0">
                    <div class="bg-white p-4 rounded-xl shadow-lg lg:sticky lg:top-8">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 border-b pb-2" data-key="nav_consultant_title">Navigation</h3>
                        <nav class="flex flex-col space-y-2">
                            <button class="nav-button active" onclick="switchConsultantPane('queue')" data-key="nav_case_queue">
                                Case Review Queue (3)
                            </button>
                            <button class="nav-button" onclick="switchConsultantPane('accounting')" data-key="nav_accounting">
                                Accounting Summary
                            </button>
                            <!-- Removed Secure Chat Button -->
                        </nav>
                    </div>
                </div>
                
                <!-- RIGHT COLUMNS: Dynamic Content Area (3/4) -->
                <div id="content-area" class="lg:col-span-3 space-y-8">
                    
                    <!-- 1. Case Review Queue (Default Pane) -->
                    <div id="pane-queue" class="consultant-pane">
                        <h2 class="text-3xl font-bold text-gray-700 mb-6" data-key="queue_title">Cases Awaiting Analysis</h2>
                        
                        <!-- Pipeline Stats (MOVED TO TOP) -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                             <div class="section-card"><p class="text-sm text-gray-500" data-key="stat_pending_analysis">Pending Analysis (Full Data)</p><p class="text-3xl font-bold mt-1 text-red-500">3</p></div>
                             <div class="section-card"><p class="text-sm text-gray-500" data-key="stat_pending_scans">Awaiting Scans/Photos in Pipeline</p><p class="text-3xl font-bold mt-1 text-amber-500">12</p></div>
                             <div class="section-card"><p class="text-sm text-gray-500" data-key="stat_ai_confidence">Average AI Complexity Score</p><p class="text-3xl font-bold mt-1 text-green-700">6.2/10</p></div>
                        </div>

                        <div class="section-card">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-key="col_id">ID / Dentist</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-key="col_priority">Priority / Comp.</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-key="col_status">Status</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-key="col_wait_time">Wait Time</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200 text-sm">
                                    <!-- Jane Chen -->
                                    <tr onclick="viewCase('4892')" class="hover:bg-gray-100 cursor-pointer">
                                        <td class="px-3 py-4 font-medium">4892 | Dr. A. Smith</td>
                                        <td class="px-3 py-4"><span class="text-xs p-1 rounded priority-high">High (8/10)</span></td>
                                        <td class="px-3 py-4 text-xs font-semibold text-sky-700" data-key="status_scans_received">Scans Received / Photos Ready</td>
                                        <td class="px-3 py-4 text-xs text-red-500">5 days</td>
                                    </tr>
                                    <!-- David Lee -->
                                    <tr onclick="viewCase('9011')" class="hover:bg-gray-100 cursor-pointer">
                                        <td class="px-3 py-4 font-medium">9011 | Dr. B. Wu</td>
                                        <td class="px-3 py-4"><span class="text-xs p-1 rounded priority-normal">Normal (5/10)</span></td>
                                        <td class="px-3 py-4 text-xs font-semibold text-yellow-700" data-key="status_waiting_ceph">Pending Ceph Drawing</td>
                                        <td class="px-3 py-4 text-xs text-gray-500">1 day</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 2. Accounting Summary Pane (NEW) -->
                    <div id="pane-accounting" class="consultant-pane hidden">
                        <h2 class="text-3xl font-bold text-gray-700 mb-6" data-key="accounting_title">Financial & Activity Summary</h2>
                        <div class="section-card">
                            <h3 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2" data-key="accounting_stats_title">Consultant Metrics (YTD)</h3>
                            <div class="grid grid-cols-2 gap-6">
                                <div class="p-3 border rounded-lg bg-indigo-50"><p class="text-sm text-gray-500" data-key="total_consults">Total Consultations Provided</p><p class="text-3xl font-bold text-indigo-700 mt-1">78</p></div>
                                <div class="p-3 border rounded-lg bg-green-50"><p class="text-sm text-gray-500" data-key="clients_active_treatment">Clients in Active Treatment</p><p class="text-3xl font-bold text-green-700 mt-1">55</p></div>
                            </div>
                        </div>
                        
                        <!-- Detailed Breakdown by Dentist (Mock) -->
                        <div class="section-card mt-8">
                            <h3 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2" data-key="accounting_dentist_title">Dentist Performance & Status</h3>
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Dentist</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Active Patients</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Avg. Stage</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase">Feedback Score</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200 text-sm">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-3 py-4 font-medium text-gray-900">Dr. A. Smith</td>
                                        <td class="px-3 py-4">15</td>
                                        <td class="px-3 py-4">Treatment (M8)</td>
                                        <td class="px-3 py-4 text-green-600">4.8 / 5.0</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-3 py-4 font-medium text-gray-900">Dr. B. Wu</td>
                                        <td class="px-3 py-4">12</td>
                                        <td class="px-3 py-4">Diagnosis Prep</td>
                                        <td class="px-3 py-4 text-amber-600">4.1 / 5.0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 3. Secure Chat Pane (NEW) -->
                    <div id="pane-chat" class="consultant-pane hidden">
                        <h2 class="text-3xl font-bold text-gray-700 mb-6" data-key="chat_title">Secure Communication with Dentists</h2>
                        <div class="section-card">
                            <div class="bg-red-50 border-l-4 border-red-400 p-4 mb-4 rounded-lg">
                                <p class="font-semibold text-red-700 text-sm" data-key="chat_pdpa_warning">PDPA WARNING: Please do not use any confidential personal health information in this chat as per the Data Processing Agreement (DPA) you have agreed to.</p>
                            </div>

                            <p class="text-sm text-gray-500 mb-4" data-key="chat_subtitle">Secure communication channel for case collaboration.</p>
                            
                            <!-- Chat Box -->
                            <div class="h-80 overflow-y-auto p-4 border rounded-lg bg-gray-50 flex flex-col space-y-3">
                                
                                <div class="p-3 rounded-xl max-w-[80%] chat-dentist shadow-sm self-start">
                                    <p class="text-xs font-semibold text-teal-800" data-key="msg_dentist_title">Dr. A. Smith (Orthodontics)</p>
                                    <p class="text-sm text-gray-800 mt-1" data-key="msg_dentist_text">I have urgent questions about the expansion rate for ID 4892's maxillary appliance based on their Month 6 progress photos.</p>
                                    <p class="text-xs text-gray-500 text-right mt-1">10:00 AM</p>
                                </div>
                                <div class="p-3 rounded-xl max-w-[80%] chat-specialist shadow-sm self-end">
                                    <p class="text-xs font-semibold text-amber-700" data-key="msg_specialist_title">You (Dr. Felix)</p>
                                    <p class="text-sm text-gray-800 mt-1" data-key="msg_specialist_text">Understood. Please review the "Analysis/Design Input" tab for my written recommendation on case 4892. Do not increase the rate further this month.</p>
                                    <p class="text-xs text-gray-500 text-right mt-1">10:15 AM</p>
                                </div>
                            </div>

                            <div class="mt-4 flex space-x-2">
                                <input type="text" placeholder="Send a secure message to the collaborating Dentist..." class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium" data-key="btn_send">Send</button>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Case Detail View (Full File: Hidden Pane, Mirrors Client Dash Tabs) -->
                    <div id="pane-client-detail" class="consultant-pane hidden">
                        <button onclick="switchConsultantPane('queue')" class="text-gray-600 font-medium text-sm mb-4 flex items-center hover:text-gray-800">
                             &larr; <span data-key="btn_back_to_queue">Back to Review Queue</span>
                        </button>
                        
                        <h2 id="client-detail-name" class="text-3xl font-bold text-gray-900 mb-6">Client ID: 4892 - Full File</h2>
                        
                        <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                            <!-- LEFT NAV BAR FOR CASE FILE -->
                            <div class="lg:col-span-1 mb-8 lg:mb-0">
                                <div class="bg-white p-4 rounded-xl shadow-lg">
                                    <h3 class="text-lg font-bold text-gray-900 mb-4 border-b pb-2" data-key="nav_client_title">Case File Review</h3>
                                    <nav class="flex flex-col space-y-2">
                                        <button class="nav-button active" onclick="switchCaseDetailTab('analysis-design')" data-key="case_tab_analysis">Analysis/Design Input</button>
                                        <button class="nav-button" onclick="switchCaseDetailTab('progress-media')" data-key="case_tab_progress">Progress Media & Scans</button>
                                        <button class="nav-button" onclick="switchCaseDetailTab('notes-chat')" data-key="case_tab_notes">Notes & Chat History</button>
                                    </nav>
                                    <button class="mt-6 py-2 px-4 bg-yellow-600 text-white font-medium rounded-lg hover:bg-yellow-700 transition duration-150 w-full" onclick="openSubmitModal()" data-key="btn_submit_opinion_detail">
                                        Submit Final Opinion
                                    </button>
                                </div>
                            </div>
                            
                            <!-- RIGHT CONTENT FOR CASE FILE -->
                            <div id="client-detail-content" class="lg:col-span-3 space-y-8">
                                
                                <!-- 1. Analysis/Design Input (Default) -->
                                <div id="case-tab-analysis-design" class="case-detail-tab">
                                    <div class="section-card">
                                        <h3 class="font-bold text-2xl text-indigo-600 mb-4 border-b pb-2" data-key="analysis_title">Design & Interventional Analysis</h3>
                                        
                                        <!-- Schwarz Analysis (From 3D Intra-Oral Scan) -->
                                        <div class="mb-6">
                                            <h4 class="font-bold text-gray-700 mb-2" data-key="schwarz_analysis_title">Schwarz Analysis (Maxillary Expansion)</h4>
                                            <textarea rows="4" id="schwarz-notes-placeholder" class="w-full p-2 border rounded-lg bg-gray-50 text-gray-800" placeholder="Enter Schwarz measurement notes and required expansion here..." data-key="schwarz_notes_placeholder"></textarea>
                                        </div>

                                        <!-- Ceph Flow Metric Analysis (X-ray drawing) -->
                                        <div class="mb-6 border-t pt-4">
                                            <h4 class="font-bold text-gray-700 mb-2" data-key="ceph_analysis_title">Ceph Flow Metric Analysis (X-ray Drawing)</h4>
                                            <div class="flex justify-between items-center bg-gray-100 p-3 rounded-lg mb-3">
                                                <p class="text-sm text-gray-700" id="ceph-drawing-status" data-key="ceph_drawing_status_pending">Status: Pending Request to 3rd Party Specialist</p>
                                                <button class="py-1 px-3 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600" onclick="requestCephDrawing()" id="btn_request_ceph" data-key="btn_request_ceph">Request Ceph Drawing</button>
                                            </div>
                                            <p class="text-sm text-gray-500" id="ceph-drawing-note" data-key="ceph_drawing_note">Sassouni Plus Ceph Drawing is required to finalize appliance design angles. Current FMA: 23°.</p>
                                        </div>

                                        <!-- Final Recommendation/Device Design -->
                                        <div class="mb-6 border-t pt-4">
                                            <h4 class="font-bold text-gray-700 mb-2" data-key="final_design_title">Final Appliance Design Summary</h4>
                                            <textarea rows="6" id="final-design-placeholder" class="w-full p-2 border rounded-lg bg-yellow-50 text-gray-800" placeholder="Enter final Start Thriving Appliance (TM) specifications here (e.g., target expansion, vertical lift, construction bite details)..." data-key="final_design_placeholder"></textarea>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 2. Progress Media & Scans -->
                                <div id="case-tab-progress-media" class="case-detail-tab hidden">
                                    <div class="section-card">
                                        <h3 class="font-bold text-2xl text-sky-600 mb-4 border-b pb-2" data-key="media_title">Patient Scans & Progress Photos</h3>

                                        <!-- INV File Access -->
                                        <div class="mb-6 p-4 border rounded-lg bg-teal-50">
                                            <p class="font-bold text-teal-800 mb-2" data-key="inv_file_access">INV File Access (Pseudonymized)</p>
                                            <p class="text-sm text-gray-700 mb-3" data-key="inv_file_note">Original INV/DICOM file is required for 3D analysis. File is encrypted.</p>
                                            <button class="py-2 px-4 bg-teal-600 text-white rounded-lg hover:bg-teal-700 text-sm font-medium" id="btn-download-inv" data-key="btn_download_inv" onclick="downloadInvFile('4892')">Download INV File (Client ID 4892)</button>
                                        </div>

                                        <!-- Photo Gallery -->
                                        <h4 class="font-bold text-gray-700 mb-3" data-key="photo_gallery_title">Jaw & Posture Photos (Current)</h4>
                                        <div id="photo-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <!-- Photos dynamically mirrored from client dashboard -->
                                            <div class="text-center">
                                                <img src="https://placehold.co/120x150/4c7c8c/ffffff?text=Jaw\n(Front)" alt="Jaw Front" class="w-full rounded-lg mb-1 mx-auto">
                                                <span class="text-xs text-gray-700 font-medium" data-key="photo_jaw_front">Jaw (Front)</span>
                                            </div>
                                            <div class="text-center">
                                                <img src="https://placehold.co/120x150/8c4c7c/ffffff?text=Posture\n(Side)" alt="Posture Side" class="w-full rounded-lg mb-1 mx-auto">
                                                <span class="text-xs text-gray-700 font-medium" data-key="photo_posture_side">Posture (Side)</span>
                                            </div>
                                            <div class="text-center">
                                                <img src="https://placehold.co/120x150/7c8c4c/ffffff?text=Jaw\n(Side)" alt="Jaw Side" class="w-full rounded-lg mb-1 mx-auto">
                                                <span class="text-xs text-gray-700 font-medium" data-key="photo_jaw_side">Jaw (Side)</span>
                                            </div>
                                            <div class="text-center">
                                                <img src="https://placehold.co/120x150/4c8c7c/ffffff?text=Jaw\n(Bottom)" alt="Jaw Bottom" class="w-full rounded-lg mb-1 mx-auto">
                                                <span class="text-xs text-gray-700 font-medium" data-key="photo_jaw_bottom">Jaw (Bottom)</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 3. Notes & Chat History -->
                                <div id="case-tab-notes-chat" class="case-detail-tab hidden">
                                    <div class="section-card">
                                        <h3 class="font-bold text-2xl text-red-600 mb-4 border-b pb-2" data-key="notes_chat_title">Notes & Secure Chat History</h3>

                                        <!-- Dentist Notes (Historical) -->
                                        <div class="mb-6 p-4 border rounded-lg bg-yellow-50">
                                            <h4 class="font-bold text-amber-700 mb-2" data-key="dentist_notes_title">Dentist Internal Notes</h4>
                                            <p class="text-sm text-gray-700" data-key="dentist_note_content">03/15/2026: Patient is compliant, but reports clicking when yawning. Check TMJ space on next scan.</p>
                                        </div>

                                        <!-- Secure Chat Mock -->
                                        <div class="p-3 bg-teal-100 border border-teal-300 rounded-lg">
                                            <h4 class="font-bold text-teal-800 mb-2" data-key="secure_chat_log_title">Secure Chat Log with Dr. A. Smith</h4>
                                            <div class="h-40 overflow-y-auto space-y-2">
                                                <div class="p-2 rounded-lg max-w-[90%] chat-dentist text-sm">... chat history ...</div>
                                                <div class="p-2 rounded-lg max-w-[90%] chat-specialist text-sm self-end">... chat history ...</div>
                                            </div>
                                            <p class="text-xs text-red-500 mt-2" data-key="chat_pdpa_warning">PDPA WARNING: Do not use PHI. Consult DPA agreement.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Opinion Submission Modal (From previous step) -->
    <div id="opinion-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden transition-opacity duration-300">
        <!-- Modal Content -->
        <div id="opinion-modal-content" class="bg-white w-full max-w-xl p-8 rounded-xl shadow-2xl relative modal-fade-enter">
            <button onclick="closeModal('opinion-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>

            <h3 id="opinion_modal_title" class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2" data-key="opinion_modal_title">Submit Professional Opinion for Client ID <span id="opinion-client-id"></span></h3>
            
            <p class="text-sm text-gray-600 mb-4" data-key="opinion_modal_prompt">Provide your detailed recommendation regarding the current diagnostics and treatment progress.</p>

            <textarea id="opinion-textarea" rows="6" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" placeholder="Type your professional opinion here (e.g., 'Recommend increasing expansion rate to 2.5 turns by month 8...')" data-key="opinion_textarea_placeholder"></textarea>
            
            <div class="flex justify-end space-x-4 mt-4">
                <button onclick="closeModal('opinion-modal')" class="py-2 px-4 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400" data-key="btn_cancel">Cancel</button>
                <button onclick="submitOpinion()" class="py-2 px-4 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 font-semibold" data-key="btn_submit_final">Submit Final Opinion</button>
            </div>
        </div>
    </div>


    <!-- JavaScript for Functionality and Translations -->
    <script>
        let currentLang = 'en';

        // --- Mock Case Data for dynamic switching ---
        const mockCaseData = {
            '4892': {
                id: '4892', name: 'Jane Chen', dentist: 'Dr. A. Smith', priority: 'High', complexity: '8/10', wait: '5 days', statusKey: 'status_scans_received',
                inv_file: 'Jane_4892_Initial_CBCT_INV.zip', ceph_status: 'pending',
                schwarz_notes_content: "Maxillary expansion goal: 5mm. Initial crossbite observed, needing full correction before vertical growth phase. Midline shift requires careful monitoring."
            },
            '9011': {
                id: '9011', name: 'David Lee', dentist: 'Dr. B. Wu', priority: 'Normal', complexity: '5/10', wait: '1 day', statusKey: 'status_waiting_ceph',
                inv_file: 'David_9011_Initial_CBCT_INV.zip', ceph_status: 'complete',
                schwarz_notes_content: "Mild crowding detected. No posterior crossbite. Expansion focuses mainly on anterior growth. Ceph drawing received and approved."
            }
        };

        // --- Translation Data Structure ---
        const translations = {
            'en': {
                'header_title': 'Professional Consultant Dashboard',
                'logout_link': '← Log Out / Portal',
                'nav_consultant_title': 'Navigation',
                'nav_case_queue': 'Case Review Queue (3)',
                'nav_accounting': 'Accounting Summary',
                'nav_secure_chat': 'Secure Chat (Dentists)',
                'queue_title': 'Cases Awaiting Analysis',
                'col_id': 'ID / Dentist',
                'col_priority': 'Priority / Comp.',
                'col_status': 'Status',
                'col_wait_time': 'Wait Time',
                'status_scans_received': 'Scans Received / Photos Ready',
                'status_waiting_ceph': 'Pending Ceph Drawing',
                'stat_pending_analysis': 'Pending Analysis (Full Data)',
                'stat_pending_scans': 'Awaiting Scans/Photos in Pipeline',
                'stat_ai_confidence': 'Average AI Complexity Score',
                'accounting_title': 'Financial & Activity Summary',
                'accounting_stats_title': 'Consultant Metrics (YTD)',
                'total_consults': 'Total Consultations Provided',
                'clients_active_treatment': 'Clients in Active Treatment',
                'chat_title': 'Secure Communication with Dentists',
                'chat_pdpa_warning': 'PDPA WARNING: Please do not use any confidential personal health information in this chat as per the Data Processing Agreement (DPA) you have agreed to.',
                'chat_subtitle': 'Secure communication channel for case collaboration.',
                'msg_dentist_title': 'Dr. A. Smith (Orthodontics)',
                'msg_dentist_text': 'I have urgent questions about the expansion rate for ID 4892\'s maxillary appliance based on their Month 6 progress photos.',
                'msg_specialist_title': 'You (Dr. Felix)',
                'msg_specialist_text': 'Understood. Please review the "Analysis/Design Input" tab for my written recommendation on case 4892. Do not increase the rate further this month.',
                'btn_send': 'Send',
                'btn_back_to_queue': 'Back to Review Queue',
                'case_details_title': 'Case Review: Client ID',
                'btn_submit_opinion_header': 'Submit Professional Opinion',
                'nav_client_title': 'Case File Review',
                'case_tab_analysis': 'Analysis/Design Input',
                'case_tab_progress': 'Progress Media & Scans',
                'case_tab_notes': 'Notes & Chat History',
                'btn_submit_opinion_detail': 'Submit Final Opinion',
                'analysis_title': 'Design & Interventional Analysis',
                'schwarz_analysis_title': 'Schwarz Analysis (Maxillary Expansion)',
                'schwarz_notes_placeholder': 'Enter Schwarz measurement notes and required expansion here...',
                'ceph_analysis_title': 'Ceph Flow Metric Analysis (X-ray Drawing)',
                'ceph_drawing_status_pending': 'Status: Pending Request to 3rd Party Specialist',
                'btn_request_ceph': 'Request Ceph Drawing',
                'ceph_drawing_note': 'Sassouni Plus Ceph Drawing is required to finalize appliance design angles. Current FMA: 23°.',
                'final_design_title': 'Final Appliance Design Summary',
                'final_design_placeholder': 'Enter final Start Thriving Appliance (TM) specifications here (e.g., target expansion, vertical lift, construction bite details)...',
                'media_title': 'Patient Scans & Progress Photos',
                'inv_file_access': 'INV File Access (Pseudonymized)',
                'inv_file_note': 'Original INV/DICOM file is required for 3D analysis. File is encrypted.',
                'btn_download_inv': 'Download INV File (Client ID [ID])',
                'photo_gallery_title': 'Jaw & Posture Photos (Current)',
                'photo_jaw_front': 'Jaw (Front)',
                'photo_posture_side': 'Posture (Side)',
                'photo_jaw_side': 'Jaw (Side)',
                'photo_jaw_bottom': 'Jaw (Bottom)',
                'notes_chat_title': 'Notes & Chat History',
                'dentist_notes_title': 'Dentist Internal Notes',
                'dentist_note_content': '03/15/2026: Patient is compliant, but reports clicking when yawning. Check TMJ space on next scan.',
                'secure_chat_log_title': 'Secure Chat Log with Dr. A. Smith',
                'btn_cancel': 'Cancel',
                'btn_submit_final': 'Submit Final Opinion',
                'opinion_modal_title': 'Submit Professional Opinion for Client ID',
                'opinion_modal_prompt': 'Provide your detailed recommendation regarding the current diagnostics and treatment progress.',
                'opinion_textarea_placeholder': 'Type your professional opinion here (e.g., \'Recommend increasing expansion rate to 2.5 turns by month 8...\')',
                'toggle_text': '中文',
                'total_revenue': 'Total AMD Revenue', 
                'appliance_revenue': 'Appliance Revenue', 
                'consultation_revenue': 'Consultation/Visit Revenue', 
                'financial_breakdown_title': 'Patient Financial Breakdown', 
                'col_financial_patient': 'Patient', 
                'col_visits': 'Clinical Visits', 
                'col_treatment_stage': 'Treatment Stage', 
                'col_revenue': 'Revenue to Date',
            },
            'zh': {
                'header_title': '專業顧問儀表板',
                'logout_link': '← 登出 / 入口網站',
                'nav_consultant_title': '導航',
                'nav_case_queue': '病例審閱隊列 (3)',
                'nav_accounting': '會計摘要',
                'nav_secure_chat': '安全聊天 (牙醫)',
                'queue_title': '待分析病例',
                'col_id': 'ID / 牙醫',
                'col_priority': '優先級 / 複雜度',
                'col_status': '狀態',
                'col_wait_time': '等待時間',
                'status_scans_received': '已收到掃描 / 照片準備就緒',
                'status_waiting_ceph': '待進行頭影描圖',
                'stat_pending_analysis': '待分析 (完整資料)',
                'stat_pending_scans': '等待掃描/照片的管線中客戶',
                'stat_ai_confidence': 'AI 平均複雜度評分',
                'accounting_title': '財務與活動摘要',
                'accounting_stats_title': '顧問指標 (年度至今)',
                'total_consults': '提供諮詢總數',
                'clients_active_treatment': '活躍治療中客戶',
                'chat_title': '與牙醫的安全溝通',
                'chat_pdpa_warning': 'PDPA 警告：根據您同意的數據處理協議 (DPA)，請勿在此聊天中使用任何機密個人健康資訊。',
                'chat_subtitle': '用於病例協作的安全溝通渠道。',
                'msg_dentist_title': 'Smith 醫生 (牙齒矯正)',
                'msg_dentist_text': '我對 ID 4892 上頜矯治器的擴展率有緊急問題，請根據他們的第 6 個月進度照片提供指導。',
                'msg_specialist_title': '您 (Dr. Felix)',
                'msg_specialist_text': '明白了。請查看「分析/設計輸入」分頁，以獲取我對病例 4892 的書面建議。本月請勿進一步增加擴展率。',
                'btn_send': '發送',
                'btn_back_to_queue': '返回審閱隊列',
                'case_details_title': '病例審閱: 客戶 ID',
                'btn_submit_opinion_header': '提交專業意見',
                'nav_client_title': '病例檔案審閱',
                'case_tab_analysis': '分析/設計輸入',
                'case_tab_progress': '進度媒體與掃描',
                'case_tab_notes': '備註與聊天歷史',
                'btn_submit_opinion_detail': '提交最終意見',
                'analysis_title': '設計與干預分析',
                'schwarz_analysis_title': 'Schwarz 分析 (上頜擴展)',
                'schwarz_notes_placeholder': '在此處輸入 Schwarz 測量備註和所需的擴展量...',
                'ceph_analysis_title': '頭影流動測量分析 (X 光描圖)',
                'ceph_drawing_status_pending': '狀態: 待請求第三方專家描圖',
                'btn_request_ceph': '請求頭影描圖',
                'ceph_drawing_note': 'Sassouni Plus 頭影描圖是確定矯治器設計角度所必需的。當前 FMA: 23°。',
                'final_design_title': '最終矯治器設計摘要',
                'final_design_placeholder': '在此處輸入最終 Start Thriving Appliance (TM) 規格（例如：目標擴展、垂直抬升、咬合設計詳情）...',
                'media_title': '患者掃描與進度照片',
                'inv_file_access': 'INV 文件訪問 (已假名化)',
                'inv_file_note': '原始 INV/DICOM 文件對於 3D 分析至關重要。文件已加密。',
                'btn_download_inv': '下載 INV 文件 (客戶 ID [ID])',
                'photo_gallery_title': '下巴與姿勢照片 (當前)',
                'photo_jaw_front': '下巴 (正面)',
                'photo_posture_side': '姿勢 (側面)',
                'photo_jaw_side': '下巴 (側面)',
                'photo_jaw_bottom': '下巴 (底部)',
                'notes_chat_title': '備註與安全聊天歷史',
                'dentist_notes_title': '牙醫內部備註',
                'dentist_note_content': '2026/03/15: 患者配合良好，但報告打哈欠時有顳顎關節彈響。下次掃描檢查 TMJ 空間。',
                'secure_chat_log_title': '與 Dr. A. Smith 的安全聊天記錄',
                'btn_cancel': '取消',
                'btn_submit_final': '提交最終意見',
                'opinion_modal_title': '提交專業意見給客戶 ID',
                'opinion_modal_prompt': '請提供您關於當前診斷和治療進度的詳細建議。',
                'opinion_textarea_placeholder': '在此處輸入您的專業意見 (例如：「建議在第 8 個月將擴展率增加到 2.5 圈...」)',
                'toggle_text': 'English',
                'total_revenue': '總 AMD 營收', 
                'appliance_revenue': '矯治器營收', 
                'consultation_revenue': '諮詢/門診營收', 
                'financial_breakdown_title': '患者財務明細', 
                'col_financial_patient': '患者', 
                'col_visits': '門診次數', 
                'col_treatment_stage': '治療階段', 
                'col_revenue': '累計營收',
            }
        };
