<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMD Practitioner Dashboard | Case Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .bg-teal-gradient {
            background-image: linear-gradient(to right, #0d9488, #059669); /* Teal 700 to 600 */
        }
        .section-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .nav-button {
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #4b5563;
            border-radius: 0.5rem;
            transition: all 0.15s ease;
        }
        .nav-button.active {
            background-color: #e6fffa; /* Teal 100 */
            color: #0d9488; /* Teal 700 */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border-right: 3px solid #0d9488;
        }
        .nav-button:not(.active):hover {
            background-color: #f0fdfa;
        }
        .alert-red {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            color: #b91c1c;
        }
        .chat-practitioner {
            background-color: #ecfdf5; /* Teal 100 */
            align-self: flex-end;
        }
        .chat-client {
            background-color: #dbeafe; /* Blue 100 */
            align-self: flex-start;
        }
        .chat-amc {
            background-color: #f3e8ff; /* Indigo 100 */
            align-self: flex-start;
        }
        .revenue-metric {
            @apply text-xl font-bold text-green-700;
        }
        .diagnostic-value {
            @apply font-semibold text-lg p-2 rounded-md mb-2 bg-green-50 border-l-4 border-green-500;
        }
        /* Tracker Styles */
        .tracker-header {
            font-size: 0.65rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            padding: 0.75rem;
        }
        /* Custom modal animation */
        .modal-fade-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-fade-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 200ms ease-out, transform 200ms ease-out;
        }
    </style>
</head>
<body>

    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-teal-gradient shadow-md">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                 <h1 id="header-title" class="text-3xl font-bold text-white" data-key="header_title">AMD Practitioner Dashboard</h1>
                <div class="flex items-center space-x-4">
                    <button id="lang-toggle" onclick="toggleLanguage()" class="py-1 px-3 rounded-full bg-white text-teal-700 border border-teal-500 hover:bg-teal-100 transition duration-150 font-semibold text-sm shadow">
                    </button>
                    <a href="index.html" class="text-sm font-medium text-teal-200 hover:text-white" data-key="logout_link">← Log Out / Portal</a>
                </div>
            </div>
        </header>

        <!-- Main Content Area with Navigation Panes -->
        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                
                <!-- LEFT COLUMN: Navigation Tabs -->
                <div class="lg:col-span-1 mb-8 lg:mb-0">
                    <div class="bg-white p-4 rounded-xl shadow-lg lg:sticky lg:top-8">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 border-b pb-2" data-key="nav_practitioner_title">Practice Navigation</h3>
                        <nav class="flex flex-col space-y-2">
                            <button id="nav-overview-btn" class="nav-button active" onclick="switchMainPane('overview')" data-key="nav_overview">
                                Practice Overview
                            </button>
                            <button class="nav-button" onclick="switchMainPane('patients')" data-key="nav_patients">
                                Patient Management
                            </button>
                            <button class="nav-button" onclick="switchMainPane('intake')" data-key="nav_intake">
                                New Patient Intake (3)
                            </button>
                            <button class="nav-button" onclick="switchMainPane('payments')" data-key="nav_payments">
                                Payments & Accounting
                            </button>
                        </nav>
                        <div class="mt-8 p-3 bg-slate-50 rounded-lg border border-slate-200">
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Logged in as:</p>
                            <p class="text-sm font-bold text-teal-700">Dr. Ryan Chiang</p>
                        </div>
                    </div>
                </div>

                <!-- RIGHT COLUMNS (3/4): Dynamic Content Area -->
                <div id="content-area" class="lg:col-span-3 space-y-8">
                    
                    <!-- 1. Practice Overview (Default Pane) -->
                    <div id="pane-overview" class="main-pane">
                        <h2 class="text-3xl font-bold text-teal-600 mb-6" data-key="overview_summary_title">Practice Summary & Metrics</h2>

                        <!-- Practice Statistics -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="section-card border-l-4 border-teal-500">
                                <p class="text-sm text-gray-500" data-key="stat_active">Active Patients</p>
                                <p class="text-4xl font-bold text-gray-900 mt-1">45</p>
                            </div>
                            <div class="section-card border-l-4 border-amber-500">
                                <p class="text-sm text-gray-500" data-key="stat_new">New Intake (30 days)</p>
                                <p class="text-4xl font-bold text-gray-900 mt-1">8</p>
                            </div>
                            <div class="section-card border-l-4 border-sky-500">
                                <p class="text-sm text-gray-500" data-key="stat_total_seen">Total Patients Seen (Historical)</p>
                                <p class="text-4xl font-bold text-gray-900 mt-1">128</p>
                            </div>
                        </div>

                        <!-- MASTER CASE TRACKER -->
                        <div class="section-card overflow-hidden">
                            <h3 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2" data-key="readiness_title">Master Case Tracker</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="tracker-header" data-key="col_patient">Patient</th>
                                            <th class="tracker-header text-center" data-i18n="col_ceph">Lateral Ceph for S+ Tracing</th>
                                            <th class="tracker-header text-center" data-i18n="col_schwarz">Models for Schwartz Analysis</th>
                                            <th class="tracker-header text-center" data-i18n="col_photos">Dental+Facial Photos</th>
                                            <th class="tracker-header text-center" data-i18n="col_cbct">CBCT Imaging</th>
                                            <th class="tracker-header text-center" data-i18n="col_rx">RX to STA Lab</th>
                                            <th class="tracker-header text-center" data-i18n="col_sta">STA Delivery Date</th>
                                            <th class="tracker-header text-right pr-4" data-key="col_status">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tracker-body" class="bg-white divide-y divide-gray-200 text-sm">
                                        <!-- Mocked 12 patients injected by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Patient Management (List Pane) -->
                    <div id="pane-patients" class="main-pane hidden">
                         <h2 class="text-3xl font-bold text-teal-600 mb-6" data-key="patient_management_title">Patient Management</h2>
                         <div class="section-card mb-4">
                             <div class="flex flex-col md:flex-row gap-4 items-center">
                                 <input type="text" id="patient-search" placeholder="Search by Name, DOB, or ID..." class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                                 <button onclick="mockSearchPatients()" class="py-3 px-6 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 transition duration-150 w-full md:w-auto" data-key="btn_search">
                                     Search Clients
                                 </button>
                             </div>
                         </div>
                         <div id="full-patient-list" class="section-card">
                             <ul class="divide-y divide-gray-200" id="management-list">
                                 <!-- Population by JS -->
                             </ul>
                         </div>
                    </div>

                    <!-- 3. New Patient Intake (Intake Pane) -->
                    <div id="pane-intake" class="main-pane hidden">
                        <h2 class="text-3xl font-bold text-teal-600 mb-6" data-key="intake_title">New Patient Intake Review</h2>
                        <div class="section-card">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2" data-key="intake_pending">3 Pending Case Assignments</h3>
                            <div class="space-y-4 divide-y divide-gray-200">
                                <div class="pt-3 flex justify-between items-center">
                                    <div>
                                        <p class="font-bold text-gray-900">Patient: Wei-Chun Tseng (ID: 1050)</p>
                                        <p class="text-sm text-gray-500">Submitted Assessment: 2025/12/12</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="acceptPatient('1050')" class="py-1 px-3 bg-green-500 text-white text-sm rounded-lg" data-key="btn_accept">Accept Patient</button>
                                        <button onclick="rejectPatient('1050')" class="py-1 px-3 bg-red-500 text-white text-sm rounded-lg" data-key="btn_reject">Reject</button>
                                    </div>
                                </div>
                                <div class="pt-3 flex justify-between items-center">
                                    <div>
                                        <p class="font-bold text-gray-900">Patient: Sophia Hsieh (ID: 1051)</p>
                                        <p class="text-sm text-gray-500">Submitted Assessment: 2025/12/10</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="acceptPatient('1051')" class="py-1 px-3 bg-green-500 text-white text-sm rounded-lg" data-key="btn_accept">Accept Patient</button>
                                        <button onclick="rejectPatient('1051')" class="py-1 px-3 bg-red-500 text-white text-sm rounded-lg" data-key="btn_reject">Reject</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Payments & Accounting Pane -->
                    <div id="pane-payments" class="main-pane hidden">
                        <h2 class="text-3xl font-bold text-teal-600 mb-6" data-key="payments_title">Payments & Accounting</h2>
                        <div class="section-card mb-8">
                            <h3 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2" data-key="revenue_summary_title">Revenue Summary (YTD)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="p-3 border rounded-lg bg-green-50">
                                    <p class="text-sm text-gray-500" data-key="total_revenue">Total AMD Revenue</p>
                                    <p class="revenue-metric mt-1">NT$ 4,820,000</p>
                                </div>
                                <div class="p-3 border rounded-lg bg-blue-50">
                                    <p class="text-sm text-gray-500">Projected LTV (6M)</p>
                                    <p class="revenue-metric mt-1">NT$ 1,200,000</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5. Client Detail View -->
                    <div id="pane-client-detail" class="main-pane hidden space-y-8">
                        <button onclick="switchMainPane('overview')" class="text-teal-600 font-medium text-sm mb-4 flex items-center">
                             &larr; <span data-key="btn_back_to_list">Back to Master Tracker</span>
                        </button>
                        
                        <div class="flex justify-between items-center mb-6 border-b pb-4">
                            <h2 id="client-detail-name" class="text-3xl font-bold text-gray-900">Jane Chen's Full File</h2>
                            <button onclick="requestConsultation()" class="py-2 px-4 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition duration-150" data-key="btn_consult_detail">
                                Refer to Specialist (Doc Felix)
                            </button>
                        </div>
                        
                        <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                            <div class="lg:col-span-1 mb-8 lg:mb-0">
                                <div class="bg-white p-4 rounded-xl shadow-lg">
                                    <h3 class="text-lg font-bold text-gray-900 mb-4 border-b pb-2">File Sections</h3>
                                    <nav class="flex flex-col space-y-2">
                                        <button class="nav-button active" onclick="switchClientDetailTab('client-plan')">Plan & Support</button>
                                        <button class="nav-button" onclick="switchClientDetailTab('client-diagnostics')">Diagnostics</button>
                                        <button class="nav-button" onclick="switchClientDetailTab('client-chat')">Care Chat</button>
                                    </nav>
                                </div>
                            </div>
                            
                            <div id="client-detail-content" class="lg:col-span-3 space-y-8">
                                <div id="client-tab-client-plan" class="client-detail-tab">
                                    <div class="section-card border-l-4 border-amber-500 mb-6">
                                        <h3 class="font-bold text-xl text-amber-600 uppercase text-xs tracking-widest mb-4">Patient Motivation</h3>
                                        <ul class="list-disc list-inside text-sm text-slate-600 space-y-2">
                                            <li>Chronic Daytime Fatigue</li>
                                            <li>Severe Neck/Shoulder Tension</li>
                                        </ul>
                                    </div>
                                    <div class="section-card">
                                        <h3 class="font-bold text-xl text-sky-600 mb-4">Clinical Status</h3>
                                        <p class="text-sm">Active Treatment Stage: <strong>Month 6</strong></p>
                                        <p class="text-sm">Current Appliance: <strong>STA (2.0 Turns)</strong></p>
                                    </div>
                                </div>
                                <div id="client-tab-client-diagnostics" class="client-detail-tab hidden">
                                    <div class="section-card">
                                        <h3 class="font-bold text-xl text-indigo-600 mb-4">Shared Diagnostic History</h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div class="p-4 bg-slate-50 border rounded-lg">
                                                <p class="text-xs font-bold text-indigo-700 uppercase mb-2">Lateral Ceph</p>
                                                <p class="text-sm font-semibold text-green-600">Analysis Ready</p>
                                            </div>
                                            <div class="p-4 bg-slate-50 border rounded-lg">
                                                <p class="text-xs font-bold text-indigo-700 uppercase mb-2">CBCT Scan</p>
                                                <p class="text-sm font-semibold text-red-600">MCS: 285mm² (Critical)</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="client-tab-client-chat" class="client-detail-tab hidden">
                                    <div class="section-card">
                                        <h3 class="font-bold text-xl text-blue-600 mb-4">AMD Patient Care Chat</h3>
                                        <div class="h-64 overflow-y-auto p-4 bg-slate-50 rounded-lg space-y-4 mb-4 flex flex-col no-scrollbar">
                                            <div class="chat-bubble chat-client p-3 rounded-xl max-w-[80%] self-start bg-blue-100 text-xs">
                                                <p class="font-bold">John Lee (Patient)</p>
                                                <p>Device feels a bit tight today.</p>
                                            </div>
                                            <div class="chat-bubble chat-practitioner p-3 rounded-xl max-w-[80%] self-end bg-teal-100 text-xs">
                                                <p class="font-bold">You (Dr. Ryan Chiang)</p>
                                                <p>That is your agency in action, John. Keep going.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- PDPA Confirmation Modal -->
    <div id="pdpa-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden transition-opacity duration-300">
        <div id="pdpa-modal-content" class="bg-white w-full max-w-lg p-8 rounded-xl shadow-2xl relative">
            <h3 class="text-2xl font-bold text-red-600 mb-4 border-b pb-2" data-key="modal_title">Specialist Consultation Request</h3>
            <p class="text-lg text-gray-800 mb-6" data-key="modal_subtitle">You are about to share pseudonymized client data with Doc Felix (California).</p>
            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6 rounded-lg">
                <p class="font-semibold text-yellow-800 mb-2" data-key="compliance_check">Compliance Check Required (PDPA/DPA):</p>
                <ul class="list-disc list-inside space-y-2 text-sm text-gray-700">
                    <li data-key="pdpa_1">Written Consent obtained for international transfer.</li>
                    <li data-key="pdpa_2">Data shared is pseudonymized (ID only).</li>
                    <li data-key="pdpa_3">Case readiness check complete (100% data points).</li>
                </ul>
            </div>
            <div class="flex justify-end space-x-4">
                <button onclick="closeModal('pdpa-modal')" class="py-2 px-4 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">Cancel</button>
                <button onclick="confirmConsultation()" class="py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold">Confirm & Refer Case</button>
            </div>
        </div>
    </div>
    
    <script>
        let currentLang = 'en';
        let currentPane = 'overview';
        
        const mockPatients = [
            { name: "John Lee", id: "TW-001", data: [1, 1, 1, 1, 0, 0], status: "Active" },
            { name: "Mei-Ling Wu", id: "TW-002", data: [1, 1, 1, 1, 1, 1], status: "Ready" },
            { name: "Kevin Chen", id: "TW-003", data: [1, 1, 0, 1, 0, 0], status: "Scan Needed" },
            { name: "Alice Chang", id: "TW-004", data: [1, 1, 1, 1, 1, 0], status: "Pending RX" },
            { name: "David Hsu", id: "TW-005", data: [0, 0, 1, 1, 0, 0], status: "Incomplete" },
            { name: "Sarah Lin", id: "TW-006", data: [1, 1, 1, 1, 1, 1], status: "Ready" },
            { name: "Robert Wang", id: "TW-007", data: [1, 1, 1, 0, 0, 0], status: "Awaiting Lab" },
            { name: "Emily Yang", id: "TW-008", data: [1, 1, 1, 1, 1, 1], status: "Ready" },
            { name: "Jason Liu", id: "TW-009", data: [0, 0, 0, 0, 0, 0], status: "New Intake" },
            { name: "Kelly Ho", id: "TW-010", data: [1, 0, 1, 1, 0, 0], status: "Incomplete" },
            { name: "Peter Tseng", id: "TW-011", data: [1, 1, 1, 1, 1, 1], status: "Ready" },
            { name: "Linda Su", id: "TW-012", data: [1, 1, 1, 1, 0, 0], status: "Active" }
        ];

        const translations = {
            'en': {
                'header_title': 'AMD Practitioner Dashboard',
                'logout_link': '← Log Out / Portal',
                'nav_practitioner_title': 'Practice Navigation',
                'nav_overview': 'Practice Overview',
                'nav_patients': 'Patient Management',
                'nav_intake': 'New Patient Intake (3)',
                'nav_payments': 'Payments & Accounting',
                'overview_summary_title': 'Practice Summary & Metrics',
                'readiness_title': 'Master Case Tracker',
                'col_patient': 'Patient Name',
                'col_status': 'Clinical Status',
                'btn_back_to_list': 'Back to Master Tracker',
                'toggle_text': '中文',
                'stat_active': 'Active Patients',
                'stat_new': 'New Intake (30 days)',
                'stat_total_seen': 'Historical Patients',
                'col_ceph': 'Lateral Ceph for S+ Tracing',
                'col_schwarz': 'Models for Schwartz Analysis',
                'col_photos': 'Dental+Facial Photos',
                'col_cbct': 'CBCT Imaging',
                'col_rx': 'RX to STA Lab',
                'col_sta': 'STA Delivery Date'
            },
            'zh': {
                'header_title': 'AMD 執業醫師儀表板',
                'logout_link': '← 登出 / 入口網站',
                'nav_practitioner_title': '診所導航',
                'nav_overview': '實務概覽',
                'nav_patients': '患者管理',
                'nav_intake': '新患者入組 (3)',
                'nav_payments': '支付與會計',
                'overview_summary_title': '實務摘要與指標',
                'readiness_title': '病例追蹤總表',
                'col_patient': '患者姓名',
                'col_status': '臨床狀態',
                'btn_back_to_list': '返回追蹤總表',
                'toggle_text': 'English',
                'stat_active': '活躍患者',
                'stat_new': '新入組 (30天)',
                'stat_total_seen': '歷史總患者',
                'col_ceph': '側位頭影測量 (S+ 追蹤)',
                'col_schwarz': '模型 (Schwartz 分析)',
                'col_photos': '牙齒+面部照片',
                'col_cbct:': 'CBCT 影像',
                'col_rx': '技工單 (STA Lab)',
                'col_sta': 'STA 交付日期'
            }
        };

        function renderTracker() {
            const body = document.getElementById('tracker-body');
            body.innerHTML = mockPatients.map(p => `
                <tr class="hover:bg-teal-50 cursor-pointer" onclick="selectPatient('${p.name}')">
                    <td class="px-3 py-4 font-medium text-gray-900">
                        <div class="flex flex-col">
                            <span>${p.name}</span>
                            <span class="text-[10px] text-gray-400 font-mono">AMD-${p.id}</span>
                        </div>
                    </td>
                    ${p.data.map(val => `
                        <td class="text-center px-3 py-4">
                            <i class="fa-solid ${val ? 'fa-circle-check text-blue-500' : 'fa-circle text-gray-200'} text-lg"></i>
                        </td>
                    `).join('')}
                    <td class="px-3 py-4 text-right pr-4">
                        <span class="text-[10px] font-bold px-2 py-1 rounded uppercase ${
                            p.status === 'Ready' ? 'bg-green-100 text-green-700' : 'bg-sky-100 text-sky-700'
                        }">${p.status}</span>
                    </td>
                </tr>
            `).join('');
        }

        function switchMainPane(paneId) {
            document.querySelectorAll('.main-pane').forEach(p => p.classList.add('hidden'));
            document.getElementById(`pane-${paneId}`).classList.remove('hidden');
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            document.querySelector(`[onclick="switchMainPane('${paneId}')"]`).classList.add('active');
        }

        function selectPatient(name) {
            document.getElementById('client-detail-name').textContent = `${name}'s File (Master View)`;
            switchMainPane('client-detail');
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'zh' : 'en';
            updateText();
        }

        function switchClientDetailTab(tabId) {
            document.querySelectorAll('.client-detail-tab').forEach(t => t.classList.add('hidden'));
            document.getElementById(`client-tab-${tabId}`).classList.remove('hidden');
            document.querySelectorAll('#pane-client-detail .nav-button').forEach(b => b.classList.remove('active'));
            document.querySelector(`[onclick="switchClientDetailTab('${tabId}')"]`).classList.add('active');
        }

        function requestConsultation() {
            document.getElementById('pdpa-modal').classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function confirmConsultation() {
            alert("Referral sent to Doc Felix. Pseudonymized case TW-001 transmitted.");
            closeModal('pdpa-modal');
        }

        function updateText() {
            const data = translations[currentLang];
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (data[key]) el.textContent = data[key];
            });
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (data[key]) el.textContent = data[key];
            });

            document.getElementById('lang-toggle').textContent = data.toggle_text;
            renderTracker();
        }

        document.addEventListener('DOMContentLoaded', updateText);
    </script>
</body>
</html>
