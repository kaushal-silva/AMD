<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMD | Practitioner Mastery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 100%);
            color: #0f172a;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 1rem;
            box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.05);
        }

        .nav-button {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem 1.25rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 700;
            color: #475569;
            transition: all 0.2s;
            width: 100%;
            text-align: left;
        }

        .nav-button.active {
            background: #0d9488;
            color: white;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }

        .nav-button:not(.active):hover {
            background: rgba(13, 148, 136, 0.05);
            color: #0d9488;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-in-out; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .case-grid-header {
            font-size: 0.65rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            padding: 0.75rem;
        }

        /* Chat Styles */
        .chat-bubble {
            padding: 0.85rem;
            border-radius: 1rem;
            max-width: 85%;
            font-size: 0.85rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .chat-specialist { background-color: #fef3c7; align-self: flex-start; border-bottom-left-radius: 0; border: 1px solid #fde68a; }
        .chat-amc { background-color: #f3e8ff; align-self: flex-start; border-bottom-left-radius: 0; border: 1px solid #e9d5ff; }
        .chat-dentist { background-color: #ccfbf1; align-self: flex-end; border-bottom-right-radius: 0; border: 1px solid #99f6e4; }
        .chat-patient { background-color: #e0f2fe; align-self: flex-start; border-bottom-left-radius: 0; border: 1px solid #bae6fd; }

        .airway-glow { filter: drop-shadow(0 0 8px rgba(14, 165, 233, 0.4)); }
        .jaw-glow { filter: drop-shadow(0 0 8px rgba(20, 184, 166, 0.3)); }

        @keyframes lung-pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }
        .pulse { animation: lung-pulse 4s infinite ease-in-out; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen">

    <div class="flex flex-col lg:flex-row max-w-[1700px] mx-auto min-h-screen">
        
        <!-- SIDEBAR -->
        <aside class="w-full lg:w-80 p-6 space-y-6 lg:sticky lg:top-0 h-screen overflow-y-auto no-scrollbar border-r border-slate-200/50">
            <div class="mb-8 px-2">
                <h1 class="text-2xl font-extrabold tracking-tight text-slate-900">AMD <span class="text-teal-600">PRO</span></h1>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest" data-i18n="tagline">Mastery Without Friction</p>
            </div>

            <!-- Practice Metrics -->
            <div class="glass-card p-5 space-y-4 border-t-4 border-teal-500">
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-wider" data-i18n="practice_stats">Practice Metrics</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase" data-i18n="active_cases">Active Cases</p>
                        <p class="text-xl font-black text-teal-600">42</p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase" data-i18n="revenue">Growth</p>
                        <p class="text-xl font-black text-emerald-600">92% <i class="fa-solid fa-arrow-up text-[10px]"></i></p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="space-y-1 pt-4">
                <button class="nav-button active" onclick="switchTab('cases')">
                    <i class="fa-solid fa-clipboard-list w-5"></i> <span data-i18n="nav_cases">Case Management</span>
                </button>
                <button class="nav-button" onclick="switchTab('intake')">
                    <i class="fa-solid fa-user-plus w-5"></i> <span data-i18n="nav_intake">New Intake</span>
                    <span class="ml-auto bg-amber-500 text-white text-[10px] px-2 py-0.5 rounded-full">3</span>
                </button>
                <button class="nav-button" onclick="switchTab('accounting')">
                    <i class="fa-solid fa-wallet w-5"></i> <span data-i18n="nav_accounting">Revenue & Growth</span>
                </button>
                <button class="nav-button" onclick="switchTab('chat')">
                    <i class="fa-solid fa-comments w-5"></i> <span data-i18n="nav_chat">Specialist Bridge</span>
                </button>
            </nav>

            <div class="pt-8 mt-auto">
                <div class="glass-card p-4 flex items-center gap-3">
                    <div class="h-10 w-10 rounded-xl bg-teal-600 flex items-center justify-center text-white font-black">RC</div>
                    <div class="text-xs">
                        <p class="font-bold">Dr. Ryan Chiang</p>
                        <p class="text-slate-500">Harmony Clinic (TW)</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN AREA -->
        <main class="flex-1 p-6 space-y-6 overflow-x-hidden">
            
            <!-- Header -->
            <header class="flex justify-between items-center bg-white/40 p-4 rounded-2xl">
                <div class="flex items-center gap-4">
                    <h2 class="text-xl font-800" data-i18n="welcome">Case Readiness Control</h2>
                </div>
                <div class="flex gap-3">
                    <div class="flex bg-slate-200/50 p-1 rounded-xl glass-card">
                        <button id="lang-en" onclick="setLanguage('en')" class="px-3 py-1 text-[10px] font-black rounded-lg transition-all bg-teal-600 text-white shadow-sm">EN</button>
                        <button id="lang-zh" onclick="setLanguage('zh')" class="px-3 py-1 text-[10px] font-black rounded-lg transition-all text-slate-500">中文</button>
                    </div>
                    <button class="p-2 h-10 w-10 glass-card flex items-center justify-center text-slate-400 hover:text-teal-600"><i class="fa-solid fa-magnifying-glass"></i></button>
                </div>
            </header>

            <!-- TAB: MASTER CASE TRACKER -->
            <div id="tab-cases" class="tab-content active space-y-6">
                <section class="glass-card overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold" data-i18n="readiness_title">Master Case Tracker</h3>
                            <p class="text-xs text-slate-400 font-semibold" data-i18n="readiness_subtitle">Complete all data points before Specialist Review.</p>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50/50 border-b border-slate-100">
                                <tr>
                                    <th class="case-grid-header w-48">Patient Name</th>
                                    <th class="case-grid-header text-center">Ceph</th>
                                    <th class="case-grid-header text-center">Models</th>
                                    <th class="case-grid-header text-center">Photos</th>
                                    <th class="case-grid-header text-center">CBCT</th>
                                    <th class="case-grid-header text-center">RX</th>
                                    <th class="case-grid-header text-center">STA</th>
                                    <th class="case-grid-header text-right pr-6">Status</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100" id="patient-rows">
                                <!-- Data injected by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <!-- TAB: PATIENT DETAIL (HIGH DEPTH) -->
            <div id="tab-patient-detail" class="tab-content space-y-6">
                <button onclick="switchTab('cases')" class="text-xs font-black text-teal-600 hover:text-teal-700 flex items-center gap-2 mb-4">
                    <i class="fa-solid fa-arrow-left"></i> <span data-i18n="back_to_list">BACK TO MASTER TRACKER</span>
                </button>
                
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    <!-- Anatomy Sync & Diagnostics -->
                    <div class="lg:col-span-8 space-y-6">
                        
                        <!-- Header & Motivations -->
                        <section class="glass-card p-8">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h2 class="text-2xl font-800 tracking-tight"><span id="detail-patient-name">John Lee</span></h2>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">AMD-TW-001 • <span data-i18n="active_growth">Active Growth (M6)</span></p>
                                </div>
                                <button onclick="triggerSpecialistRequest()" class="px-6 py-3 bg-teal-600 text-white rounded-xl font-black text-xs uppercase shadow-lg shadow-teal-100 flex items-center gap-2">
                                    <i class="fa-solid fa-paper-plane"></i> <span data-i18n="btn_refer">Refer to Doc Felix</span>
                                </button>
                            </div>

                            <!-- Anatomy Sync (From Client Dashboard) -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 py-6 border-y border-slate-100 mb-6">
                                <div class="flex flex-col items-center">
                                    <svg viewBox="0 0 200 200" class="w-40 h-40">
                                        <path d="M100,20 Q120,60 110,100 T105,180" fill="none" stroke="#e2e8f0" stroke-width="20" stroke-linecap="round" />
                                        <path d="M100,20 Q135,60 125,100 T120,180" fill="none" stroke="#0ea5e9" stroke-width="24" stroke-linecap="round" class="airway-glow pulse" />
                                    </svg>
                                    <p class="mt-4 text-[10px] font-black text-sky-600 uppercase tracking-widest" data-i18n="airway_viz">Airway Target</p>
                                </div>
                                <div class="flex flex-col items-center">
                                    <svg viewBox="0 0 200 200" class="w-40 h-40">
                                        <path d="M40,150 Q40,50 100,50 Q160,50 160,150" fill="none" stroke="#e2e8f0" stroke-width="12" stroke-linecap="round" stroke-dasharray="4 4" />
                                        <path d="M25,150 Q25,35 100,35 Q175,35 175,150" fill="none" stroke="#14b8a6" stroke-width="15" stroke-linecap="round" class="jaw-glow" />
                                    </svg>
                                    <p class="mt-4 text-[10px] font-black text-teal-600 uppercase tracking-widest" data-i18n="jaw_viz">Jaw Target</p>
                                </div>
                            </div>

                            <!-- Goals Snapshot -->
                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 bg-amber-50 rounded-2xl border border-amber-100">
                                    <h4 class="text-[10px] font-black text-amber-700 uppercase mb-2">Primary Pain</h4>
                                    <p class="text-sm font-bold">Chronic Daytime Fatigue</p>
                                </div>
                                <div class="p-4 bg-indigo-50 rounded-2xl border border-indigo-100">
                                    <h4 class="text-[10px] font-black text-indigo-700 uppercase mb-2">Active Intervention</h4>
                                    <p class="text-sm font-bold">STA (2.0 Turns / 0.50mm)</p>
                                </div>
                            </div>
                        </section>

                        <!-- Diagnostic Vault (Replicated from Client Dash) -->
                        <section class="glass-card p-8">
                            <h3 class="text-lg font-bold mb-6" data-i18n="vault_title">Diagnostic Inputs</h3>
                            <div class="space-y-4">
                                <div class="p-4 bg-slate-50 rounded-2xl border border-slate-200 flex justify-between items-center">
                                    <div class="flex items-center gap-4">
                                        <div class="h-10 w-10 bg-sky-100 text-sky-600 rounded-xl flex items-center justify-center"><i class="fa-solid fa-lungs"></i></div>
                                        <div>
                                            <p class="text-xs font-bold">CBCT Airway Scan</p>
                                            <p class="text-[10px] text-slate-400 font-black">MCS: 285mm² • 2025/12/10</p>
                                        </div>
                                    </div>
                                    <button class="text-[10px] font-black text-sky-600 uppercase hover:underline">View Scan</button>
                                </div>
                                <div class="p-4 bg-slate-50 rounded-2xl border border-slate-200 flex justify-between items-center">
                                    <div class="flex items-center gap-4">
                                        <div class="h-10 w-10 bg-teal-100 text-teal-600 rounded-xl flex items-center justify-center"><i class="fa-solid fa-tooth"></i></div>
                                        <div>
                                            <p class="text-xs font-bold">Schwarz Analysis (Models)</p>
                                            <p class="text-[10px] text-slate-400 font-black">5mm Crossbite Correction • Ready</p>
                                        </div>
                                    </div>
                                    <button class="text-[10px] font-black text-teal-600 uppercase hover:underline">Review Analysis</button>
                                </div>
                            </div>
                        </section>
                    </div>

                    <!-- Sidebar: Business & Chat -->
                    <div class="lg:col-span-4 space-y-6">
                        <!-- Revenue Impact -->
                        <div class="glass-card p-6 bg-slate-900 text-white">
                            <h4 class="text-xs font-black text-slate-500 uppercase tracking-wider mb-4">Practice Impact</h4>
                            <div class="space-y-4">
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase">Projected LTV</p>
                                    <p class="text-2xl font-black text-teal-400">NT$ 185,000</p>
                                </div>
                                <button class="w-full py-3 bg-teal-600 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-teal-700">Schedule Adj Visit</button>
                            </div>
                        </div>

                        <!-- Care Chat -->
                        <div class="glass-card flex flex-col h-[500px] overflow-hidden">
                            <div class="p-4 border-b border-slate-100">
                                <h4 class="text-xs font-black text-slate-400 uppercase tracking-wider">AMD Care Chat</h4>
                            </div>
                            <div class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar flex flex-col">
                                <div class="chat-bubble chat-patient">
                                    <p class="text-[8px] font-black text-sky-800 uppercase mb-1">John Lee (Patient)</p>
                                    <p class="text-xs leading-tight">Feels tight near back molars today.</p>
                                </div>
                                <div class="chat-bubble chat-dentist">
                                    <p class="text-[8px] font-black text-teal-800 uppercase mb-1">You</p>
                                    <p class="text-xs leading-tight">That's your agency in action, John. Keep going.</p>
                                </div>
                            </div>
                            <div class="p-4 border-t border-slate-100 flex gap-2">
                                <input type="text" placeholder="Message patient..." class="flex-1 text-xs outline-none">
                                <button class="h-8 w-8 bg-teal-600 text-white rounded-lg flex items-center justify-center"><i class="fa-solid fa-paper-plane text-[10px]"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: NEW INTAKE -->
            <div id="tab-intake" class="tab-content space-y-6">
                <section class="glass-card p-8">
                    <h2 class="text-2xl font-800 mb-6 tracking-tight">Pending Intake Reviews (3)</h2>
                    <div class="space-y-4">
                        <div class="p-6 bg-slate-50 rounded-2xl border border-slate-200 flex justify-between items-center">
                            <div>
                                <p class="text-lg font-bold">Wei-Chun Tseng</p>
                                <p class="text-xs font-semibold text-amber-600">Headaches & Fatigue • High Airway Risk</p>
                            </div>
                            <button class="px-6 py-2 bg-teal-600 text-white rounded-xl font-black text-[10px] uppercase">Claim & Review</button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TAB: REVENUE & GROWTH -->
            <div id="tab-accounting" class="tab-content space-y-6">
                <section class="glass-card p-8">
                    <h2 class="text-2xl font-800 mb-6 tracking-tight">Practice Mastery Dashboard</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="p-6 bg-teal-50 rounded-2xl border border-teal-100">
                            <p class="text-[10px] font-black text-teal-600 uppercase mb-1">YTD Revenue</p>
                            <p class="text-3xl font-black">NT$ 4.82M</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TAB: SPECIALIST BRIDGE -->
            <div id="tab-chat" class="tab-content space-y-6">
                <section class="glass-card p-8 h-[600px] flex flex-col">
                    <h2 class="text-2xl font-800 mb-6 tracking-tight">Specialist Secure Bridge</h2>
                    <div class="flex-1 overflow-y-auto space-y-4 flex flex-col no-scrollbar">
                        <div class="chat-bubble chat-specialist">
                            <p class="text-[9px] font-black text-amber-800 uppercase mb-1">Doc Felix (Specialist)</p>
                            <p class="text-sm italic">"Ryan, look at the velopharynx restriction here..."</p>
                        </div>
                    </div>
                </section>
            </div>

        </main>
    </div>

    <!-- DPA COMPLIANCE MODAL -->
    <div id="modal-dpa" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50 hidden p-4">
        <div class="glass-card max-w-lg w-full p-8 shadow-2xl">
            <h3 class="text-xl font-black text-slate-900 mb-2 uppercase tracking-tight" data-i18n="modal_title">Specialist Referral Check</h3>
            <p class="text-sm text-slate-500 mb-6" data-i18n="modal_subtitle">You are about to share clinical files with Doc Felix (California, USA).</p>

            <div class="bg-amber-50 rounded-2xl p-6 border border-amber-100 space-y-4 mb-6">
                <h4 class="text-[10px] font-black text-amber-700 uppercase tracking-widest" data-i18n="compliance_header">PDPA/DPA Compliance Checklist</h4>
                <div class="flex items-start gap-3">
                    <input type="checkbox" id="check-1" class="mt-1">
                    <label for="check-1" class="text-xs text-slate-600 font-semibold" data-i18n="check_1">Patient has signed Written Consent for international data transfer.</label>
                </div>
                <div class="flex items-start gap-3">
                    <input type="checkbox" id="check-2" class="mt-1">
                    <label for="check-2" class="text-xs text-slate-600 font-semibold" data-i18n="check_2">Consultation is covered under existing Practice-to-Specialist DPA.</label>
                </div>
                <div class="flex items-start gap-3">
                    <input type="checkbox" id="check-3" class="mt-1">
                    <label for="check-3" class="text-xs text-slate-600 font-semibold" data-i18n="check_3">Files are pseudonymized (Patient ID: AMD-TW-001 used).</label>
                </div>
            </div>

            <div class="flex gap-4">
                <button onclick="closeModal()" class="flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-black text-xs uppercase" data-i18n="btn_cancel">Cancel</button>
                <button onclick="confirmReferral()" class="flex-1 py-3 bg-teal-600 text-white rounded-xl font-black text-xs uppercase shadow-lg shadow-teal-100" data-i18n="btn_confirm">Confirm & Refer</button>
            </div>
        </div>
    </div>

    <script>
        const i18n = {
            en: {
                tagline: "Mastery Without Friction",
                practice_stats: "Practice Metrics",
                active_cases: "Active Cases",
                revenue: "Growth",
                nav_cases: "Case Management",
                nav_intake: "New Intake",
                nav_accounting: "Revenue & Growth",
                nav_chat: "Specialist Bridge",
                welcome: "Case Readiness Control",
                readiness_title: "Master Case Tracker",
                readiness_subtitle: "Complete all data points before Specialist Review.",
                active_growth: "Active Growth (M6)",
                back_to_list: "Back to Master Tracker",
                btn_refer: "Refer to Doc Felix",
                airway_viz: "Airway Target",
                jaw_viz: "Jaw Target",
                vault_title: "Diagnostic Inputs",
                modal_title: "Specialist Referral Check",
                modal_subtitle: "You are about to share clinical files with Doc Felix (California, USA).",
                compliance_header: "PDPA/DPA Compliance Checklist",
                check_1: "Patient has signed Written Consent for international data transfer.",
                check_2: "Consultation is covered under existing Practice-to-Specialist DPA.",
                check_3: "Files are pseudonymized (Patient ID: AMD-TW-001 used).",
                btn_cancel: "Cancel",
                btn_confirm: "Confirm & Refer"
            },
            zh: {
                tagline: "無摩擦的專業掌控",
                practice_stats: "診所數據",
                active_cases: "活躍病例",
                revenue: "營收增長",
                nav_cases: "病例管理",
                nav_intake: "新患者入組",
                nav_accounting: "營收與增長",
                nav_chat: "專家橋接",
                welcome: "病例準備度控制",
                readiness_title: "病例追蹤總表",
                readiness_subtitle: "在專家審閱前完成所有數據點。",
                active_growth: "積極生長中 (第6個月)",
                back_to_list: "返回病例追蹤表",
                btn_refer: "轉介給 Doc Felix",
                airway_viz: "氣道目標",
                jaw_viz: "下顎目標",
                vault_title: "診斷輸入",
                modal_title: "專家轉介合規檢查",
                modal_subtitle: "您即將與 Doc Felix (美國加州) 分享臨床檔案。",
                compliance_header: "PDPA/DPA 合規清單",
                check_1: "患者已簽署國際數據傳輸書面同意書。",
                check_2: "此會診已涵蓋在現有的醫師-專家 DPA 協議中。",
                check_3: "檔案已進行去識別化處理 (使用患者 ID: AMD-TW-001)。",
                btn_cancel: "取消",
                btn_confirm: "確認並轉介"
            }
        };

        const patients = [
            { name: "John Lee", id: "001", data: [1, 1, 1, 1, 0, 0], status: "Incomplete" },
            { name: "Mei-Ling Wu", id: "002", data: [1, 1, 1, 1, 1, 1], status: "Ready" },
            { name: "Kevin Chen", id: "003", data: [1, 1, 0, 1, 0, 0], status: "Incomplete" },
            { name: "Alice Chang", id: "004", data: [1, 1, 1, 1, 1, 0], status: "Incomplete" },
            { name: "David Hsu", id: "005", data: [0, 0, 1, 1, 0, 0], status: "Critical" },
            { name: "Sarah Lin", id: "006", data: [1, 1, 1, 1, 1, 1], status: "Ready" },
            { name: "Robert Wang", id: "007", data: [1, 1, 1, 0, 0, 0], status: "Incomplete" },
            { name: "Emily Yang", id: "008", data: [1, 1, 1, 1, 1, 1], status: "Ready" },
            { name: "Jason Liu", id: "009", data: [0, 0, 0, 0, 0, 0], status: "Intake" },
            { name: "Kelly Ho", id: "010", data: [1, 0, 1, 1, 0, 0], status: "Incomplete" },
            { name: "Peter Tseng", id: "011", data: [1, 1, 1, 1, 1, 1], status: "Ready" },
            { name: "Linda Su", id: "012", data: [1, 1, 1, 1, 0, 0], status: "Incomplete" }
        ];

        let currentLang = 'en';

        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[lang][key]) el.textContent = i18n[lang][key];
            });
            renderPatients();
            document.getElementById('lang-en').className = `px-3 py-1 text-[10px] font-black rounded-lg transition-all ${lang === 'en' ? 'bg-teal-600 text-white shadow-sm' : 'text-slate-500'}`;
            document.getElementById('lang-zh').className = `px-3 py-1 text-[10px] font-black rounded-lg transition-all ${lang === 'zh' ? 'bg-teal-600 text-white shadow-sm' : 'text-slate-500'}`;
        }

        function switchTab(tabId) {
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`[onclick="switchTab('${tabId}')"]`);
            if (activeBtn) activeBtn.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            const activeTab = document.getElementById('tab-' + tabId);
            if (activeTab) activeTab.classList.add('active');
        }

        function openPatient(name) {
            document.getElementById('detail-patient-name').textContent = name;
            switchTab('patient-detail');
        }

        function renderPatients() {
            const container = document.getElementById('patient-rows');
            container.innerHTML = patients.map(p => `
                <tr class="hover:bg-slate-50 transition-colors cursor-pointer" onclick="openPatient('${p.name}')">
                    <td class="px-3 py-4">
                        <p class="text-xs font-bold text-slate-800">${p.name}</p>
                        <p class="text-[9px] text-slate-400 font-black">AMD-TW-${p.id}</p>
                    </td>
                    ${p.data.map(val => `
                        <td class="text-center px-3 py-4">
                            <i class="fa-solid ${val ? 'fa-circle-check text-blue-500' : 'fa-circle text-slate-200'}"></i>
                        </td>
                    `).join('')}
                    <td class="text-right px-3 py-4 pr-6">
                        <span class="text-[9px] font-black px-2 py-1 rounded-md uppercase ${
                            p.status === 'Ready' ? 'bg-blue-100 text-blue-700' : 
                            p.status === 'Critical' ? 'bg-red-100 text-red-600' : 'bg-slate-100 text-slate-500'
                        }">${p.status}</span>
                    </td>
                </tr>
            `).join('');
        }

        function triggerSpecialistRequest() {
            document.getElementById('modal-dpa').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-dpa').classList.add('hidden');
        }

        function confirmReferral() {
            const c1 = document.getElementById('check-1').checked;
            const c2 = document.getElementById('check-2').checked;
            const c3 = document.getElementById('check-3').checked;

            if (c1 && c2 && c3) {
                alert("Request Sent to Doc Felix. Case AMD-TW-001 is now under Specialist Review.");
                closeModal();
            } else {
                alert("Please confirm all compliance points before sharing clinical data.");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderPatients();
            setLanguage('en');
        });
    </script>
</body>
</html>
