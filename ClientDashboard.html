<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMD Client Dashboard | Tabbed View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }
        .section-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .alert-red {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            color: #b91c1c;
        }
        .chat-client {
            background-color: #dbeafe; /* Blue 100 */
            align-self: flex-end;
        }
        .chat-doctor {
            background-color: #ecfdf5; /* Teal 100 */
            align-self: flex-start;
        }
        .chat-amc {
            background-color: #f3e8ff; /* Indigo 100 */
            align-self: flex-start;
        }
        .tab-button {
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #4b5563;
            border-radius: 0.5rem;
            transition: all 0.15s ease;
        }
        .tab-button.active {
            background-color: #e0f2fe; /* Sky 100 */
            color: #0369a1; /* Sky 700 */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border-right: 3px solid #0ea5e9;
        }
        .tab-button:not(.active):hover {
            background-color: #f3f4f6;
        }
        /* Custom styling for the range input track/thumb */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #0ea5e9; /* Sky 500 */
            cursor: pointer;
            margin-top: -7px; 
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>

    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-sky-600 shadow-md">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                <h1 id="header-title" class="text-3xl font-bold text-white" data-key="header_title">AMD Client Dashboard</h1>
                <div class="flex items-center space-x-4">
                    <!-- Language Toggle Button -->
                    <button id="lang-toggle" onclick="toggleLanguage()" class="py-1 px-3 rounded-full bg-white text-sky-700 border border-sky-500 hover:bg-sky-100 transition duration-150 font-semibold text-sm shadow">
                        <!-- Text updated by JavaScript -->
                    </button>
                    <a href="index.html" class="text-sm font-medium text-sky-200 hover:text-white" data-key="logout_link">← Log Out / Portal</a>
                </div>
            </div>
        </header>

        <!-- Main Content Area with Tabs -->
        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="lg:grid lg:grid-cols-4 lg:gap-8">
                
                <!-- LEFT COLUMN: Navigation Tabs -->
                <div class="lg:col-span-1 mb-8 lg:mb-0">
                    <div class="bg-white p-4 rounded-xl shadow-lg lg:sticky lg:top-8">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 border-b pb-2" data-key="nav_title">Navigation</h3>
                        <nav class="flex flex-col space-y-2">
                            <button class="tab-button active" onclick="switchTab('my-plan')" data-key="tab_my_plan">
                                My Plan & Support
                            </button>
                            <button class="tab-button" onclick="switchTab('diagnostics')" data-key="tab_diagnostics">
                                Diagnostic Inputs
                            </button>
                            <button class="tab-button" onclick="switchTab('progress')" data-key="tab_progress">
                                Progress Tracker
                            </button>
                            <button class="tab-button" onclick="switchTab('chat')" data-key="tab_chat">
                                Secure Group Chat
                            </button>
                        </nav>
                    </div>
                </div>

                <!-- RIGHT COLUMN: Tab Content -->
                <div class="lg:col-span-3 space-y-8">
                    
                    <!-- 1. My Plan & Support Tab (Default) -->
                    <div id="tab-my-plan" class="tab-content space-y-8">
                        
                        <!-- Patient Goals & Pain Tracking -->
                        <div class="section-card">
                            <h2 class="text-3xl font-extrabold text-gray-900 mb-4 border-b pb-2 text-sky-600" data-key="sec_goals_title_impact">My Journey: Goals & Motivation</h2>
                            <p class="text-sm text-gray-600 mb-4" data-key="goals_motivation_intro">Focus on these goals—they are the powerful symptoms we are working together to eliminate through holistic treatment.</p>
                            
                            <div class="mb-5">
                                <h3 class="font-bold text-gray-700 mb-2" data-key="goals_list_title">My 3 Symptoms to Eliminate:</h3>
                                <ul class="list-disc list-inside text-sm text-sky-700 font-semibold space-y-1 pl-4">
                                    <li data-key="goal1">Chronic Daytime Fatigue</li>
                                    <li data-key="goal2">Frequent Neck/Shoulder Tension</li>
                                    <li data-key="goal3">Waking up with dry mouth</li>
                                </ul>
                            </div>

                            <div class="mb-5">
                                <h3 class="font-bold text-gray-700 mb-2" data-key="pains_list_title">Existing Pains/Conditions:</h3>
                                <ul class="list-disc list-inside text-sm text-gray-600 space-y-1 pl-4">
                                    <li data-key="pain1">Jaw clicking (Left TMJ)</li>
                                    <li data-key="pain2">Morning headaches</li>
                                    <li data-key="pain3">Reflux (GERD)</li>
                                </ul>
                            </div>
                            <button class="w-full py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 text-sm font-medium" data-key="btn_update_goals">Update Pains & Goals</button>
                        </div>

                        <!-- Treatment Interventions -->
                        <div class="section-card">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2 text-yellow-600" data-key="sec_interventions_title">Treatment Interventions</h2>

                            <!-- Start Thriving Appliance Section (Updated with Visuals) -->
                            <div class="mb-8 p-6 border rounded-lg bg-yellow-50/50">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800" data-key="appliance_title">Start Thriving Appliance (TM)</h3>
                                        <p class="text-sm text-gray-500 mt-1" data-key="appliance_subtitle">Visualizing your appliance adjustment journey.</p>
                                    </div>
                                    <div class="text-right">
                                         <span id="appliance-percentage" class="text-2xl font-extrabold text-yellow-600"></span>
                                         <p class="text-xs text-gray-500" data-key="completion_label">Complete</p>
                                    </div>
                                </div>
                                
                                <!-- Appliance State Display -->
                                <div class="flex flex-col md:flex-row gap-6 items-center mb-6">
                                    <!-- Dynamic Image -->
                                    <div class="w-full md:w-1/2">
                                        <img id="appliance-image" src="" alt="Start Thriving Appliance State" class="w-full rounded-lg shadow-md border border-yellow-200">
                                    </div>
                                    
                                    <!-- Current State Info -->
                                    <div class="w-full md:w-1/2 bg-white p-4 rounded-lg shadow-sm border border-yellow-100">
                                        <h4 class="font-bold text-gray-700 mb-2 border-b pb-1" data-key="status_at_month_title">Treatment Status at Month <span id="display-month"></span>:</h4>
                                        <p id="appliance-setting-text" class="text-lg font-medium text-yellow-700 mb-1"></p>
                                        <p id="appliance-notes-text" class="text-sm text-gray-500"></p>
                                    </div>
                                </div>

                                <!-- Interactive Timeline/Slider -->
                                <div class="mb-2">
                                    <input type="range" min="0" max="24" value="6" step="1" class="w-full h-2 bg-yellow-200 rounded-lg appearance-none cursor-pointer" id="appliance-timeline-slider" oninput="updateApplianceTimeline(this.value)">
                                    <div class="flex justify-between text-xs mt-2 text-gray-500 font-medium">
                                        <span data-key="app_start">Start (Month 0)</span>
                                        <span data-key="app_current_marker">Current (Month 6)</span>
                                        <span data-key="app_24m">Target (Month 24)</span>
                                    </div>
                                </div>
                                
                                <button class="mt-6 py-2 px-4 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 text-sm font-medium w-full md:w-auto" data-key="btn_request_adjustment">Request Appliance Adjustment</button>
                            </div>

                            <!-- Nutrition Section -->
                            <div class="p-4 border rounded-lg bg-teal-50/50">
                                <h3 class="font-bold text-gray-700 mb-2" data-key="nutrition_title">Prescribed Nutrition Focus:</h3>
                                <ul class="list-disc list-inside text-sm text-gray-600 space-y-1 pl-4 mb-3">
                                    <li data-key="nut_bonebroth">Increase intake of bone broth for collagen support.</li>
                                    <li data-key="nut_calcium">Ensure adequate calcium and magnesium levels.</li>
                                    <li data-key="nut_fattyacids">Focus on essential fatty acids (Omega-3).</li>
                                </ul>
                                <button class="w-full py-2 bg-indigo-500 text-white font-medium rounded-lg hover:bg-indigo-600 transition duration-150" data-key="btn_order_supplements">
                                    Order Supplements Now
                                </button>
                            </div>
                        </div>
                        
                        <!-- AMC Support -->
                        <div class="section-card">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2 text-teal-600" data-key="sec_amc_support_title">AMC & Support</h2>
                            <div class="mb-5">
                                <h3 class="font-bold text-gray-700 mb-2" data-key="amc_coordinator_title">Assigned Coordinator: Jane Chen (AMC)</h3>
                                <p class="text-sm text-gray-600 mb-3" data-key="amc_coordinator_desc">Your dedicated health coach for administrative and non-clinical guidance.</p>
                                <button class="w-full py-2 bg-teal-500 text-white font-medium rounded-lg hover:bg-teal-600 transition duration-150" data-key="btn_arrange_appointment">
                                    Arrange AMC Appointment
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Diagnostic Inputs Tab -->
                    <div id="tab-diagnostics" class="tab-content space-y-8 hidden">
                        <div class="section-card">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-2 text-indigo-600" data-key="sec_diagnostics_title">AMD Diagnostic Inputs</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                
                                <!-- 1. CB CT Scan -->
                                <div class="border p-4 rounded-lg bg-gray-50">
                                    <h3 class="font-bold text-indigo-700 mb-2" data-key="cbct_title">CB CT Scan (Airway)</h3>
                                    <p class="text-xs text-gray-600 mb-2" data-key="cbct_desc">Used to measure Minimal Cross Section (MCS).</p>
                                    
                                    <div class="font-semibold text-lg p-2 rounded-md mb-2 alert-red">
                                        <span data-key="mcs_value">MCS: 285 mm²</span> <span data-key="mcs_status">(Critical!)</span>
                                    </div>
                                    
                                    <p class="text-xs text-gray-500" data-key="cbct_note">Doctor Note (10/12/2025): Significant restriction noted in velopharynx. Immediate intervention required.</p>
                                    <button class="mt-2 text-sm text-indigo-500 hover:underline" data-key="btn_view_cbct">View Full Scan / Upload New</button>
                                </div>

                                <!-- 2. 3D Intra-Oral Scan -->
                                <div class="border p-4 rounded-lg bg-gray-50">
                                    <h3 class="font-bold text-indigo-700 mb-2" data-key="intraoral_title">3D Intra-Oral Scan (Teeth)</h3>
                                    <p class="text-xs text-gray-600 mb-2" data-key="intraoral_desc">Used for Schwarz Analysis measurements.</p>
                                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-2 rounded-md mb-2">
                                        <p class="text-xs font-semibold text-yellow-800" data-key="schwarz_status">Schwarz Analysis Ready</p>
                                    </div>
                                    <p class="text-xs text-gray-500" data-key="schwarz_note">Analysis shows 5mm maxillary posterior crossbite correction needed.</p>
                                    <button class="mt-2 text-sm text-indigo-500 hover:underline" data-key="btn_view_schwarz">View Analysis & Report</button>
                                </div>

                                <!-- 3. Ceph Flow Metric Analysis -->
                                <div class="border p-4 rounded-lg bg-gray-50">
                                    <h3 class="font-bold text-indigo-700 mb-2" data-key="ceph_title">Ceph Flow Metric Analysis</h3>
                                    <p class="text-xs text-gray-600 mb-2" data-key="ceph_desc">Used for Sassouni Plus Ceph Analysis.</p>
                                    <div class="bg-green-50 border-l-4 border-green-500 p-2 rounded-md mb-2">
                                        <p class="text-xs font-semibold text-green-800" data-key="sassouni_status">Sassouni Plus Report</p>
                                    </div>
                                    <p class="text-xs text-gray-500" data-key="sassouni_note">Informs appliance growth angles. Current FMA: 23°.</p>
                                    <button class="mt-2 text-sm text-indigo-500 hover:underline" data-key="btn_view_sassouni">View Report & Angles</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Progress Tracker Tab -->
                    <div id="tab-progress" class="tab-content space-y-8 hidden">
                        <div class="section-card">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-2 text-sky-600" data-key="progress_title">Progress Photo Timeline</h2>
                            <p class="text-sm text-gray-500 mb-4" data-key="progress_subtitle">Track your jaw and posture changes over the 18-month growth prescription period.</p>
                            
                            <!-- Comparison Slider and Images (Updated for multiple checkpoints) -->
                            <h3 class="font-bold text-gray-700 mb-4" data-key="comparison_title">Historical Comparison View</h3>
                            
                            <div class="bg-gray-100 p-4 rounded-lg mb-4">
                                <label for="comparison-slider" id="comparison-label" class="block text-sm font-medium text-gray-700 mb-2"></label>
                                <!-- Max set to 4 for 5 checkpoints (0 to 4) -->
                                <input type="range" min="0" max="4" value="0" step="1" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer" id="comparison-slider" oninput="updateComparisonView(this.value)">
                                <div class="flex justify-between text-xs mt-1 text-gray-500">
                                    <span data-key="comp_c0">Initial</span>
                                    <span data-key="comp_c1">Month 3</span>
                                    <span data-key="comp_c2">Month 6</span>
                                    <span data-key="comp_c3">Month 12</span>
                                    <span data-key="comp_c4">Current</span>
                                </div>
                            </div>

                            <div id="photo-comparison-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <!-- Photos injected by JavaScript -->
                            </div>

                            <button class="mt-6 w-full py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 text-sm font-medium" data-key="upload_photo">Upload New Progress Photo</button>
                        </div>
                    </div>

                    <!-- 4. Secure Group Chat Tab -->
                    <div id="tab-chat" class="tab-content space-y-8 hidden">
                         <div class="section-card">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2 text-blue-600" data-key="sec_chat_title">Secure Group Chat</h2>
                            <p class="text-sm text-gray-500 mb-4" data-key="chat_subtitle">Communicate directly with your Doctor and AMC.</p>
                            
                            <!-- Chat Box -->
                            <div class="h-80 overflow-y-auto p-4 border rounded-lg bg-gray-50 flex flex-col space-y-3">
                                
                                <!-- Doctor Message -->
                                <div class="p-3 rounded-xl max-w-[80%] chat-doctor shadow-sm">
                                    <p class="text-xs font-semibold text-teal-800" data-key="msg_doctor_title">Dr. Smith (Practitioner)</p>
                                    <p class="text-sm text-gray-800 mt-1" data-key="msg_doctor_text">Hello, I have reviewed your latest CBCT. Please ensure you are wearing the appliance for the full prescribed time daily.</p>
                                    <p class="text-xs text-gray-500 text-right mt-1">11:30 AM</p>
                                </div>

                                <!-- AMC Message -->
                                <div class="p-3 rounded-xl max-w-[80%] chat-amc shadow-sm">
                                    <p class="text-xs font-semibold text-indigo-800" data-key="msg_amc_title">Jane Chen (AMC)</p>
                                    <p class="text-sm text-gray-800 mt-1" data-key="msg_amc_text">I've scheduled your next nutrition coaching session for next Tuesday at 4 PM. Confirmation email sent.</p>
                                    <p class="text-xs text-gray-500 text-right mt-1">1:45 PM</p>
                                </div>

                                <!-- Client Message -->
                                <div class="p-3 rounded-xl max-w-[80%] chat-client shadow-sm self-end">
                                    <p class="text-xs font-semibold text-blue-800" data-key="msg_client_title">You (Client)</p>
                                    <p class="text-sm text-gray-800 mt-1" data-key="msg_client_text">Understood, Dr. Smith. I've been consistent. Jane, thank you for setting that up!</p>
                                    <p class="text-xs text-gray-500 text-right mt-1">2:01 PM</p>
                                </div>
                            </div>

                            <!-- Input Field Mock -->
                            <div class="mt-4 flex space-x-2">
                                <input type="text" id="chat-input" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Type your message...">
                                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium" data-key="btn_send">Send</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript for Tab Switching and Translations -->
    <script>
        let currentLang = 'en';
        const monthsCompleted = 6;
        const totalPrescriptionMonths = 24;
        const percentageCompleted = Math.round((monthsCompleted / totalPrescriptionMonths) * 100);

        // --- Translation Data Structure (JSON) ---
        const translations = {
            'en': {
                'header_title': 'AMD Client Dashboard',
                'logout_link': '← Log Out / Portal',
                'nav_title': 'Navigation',
                'tab_my_plan': 'My Plan & Support',
                'tab_diagnostics': 'Diagnostic Inputs',
                'tab_progress': 'Progress Tracker',
                'tab_chat': 'Secure Group Chat',
                'sec_goals_title_impact': 'My Journey: Goals & Motivation',
                'goals_motivation_intro': 'Focus on these goals—they are the powerful symptoms we are working together to eliminate through holistic treatment.',
                'sec_goals_title': 'My Goals & Pains',
                'goals_list_title': 'My 3 Symptoms to Eliminate:',
                'goal1': 'Chronic Daytime Fatigue',
                'goal2': 'Frequent Neck/Shoulder Tension',
                'goal3': 'Waking up with dry mouth',
                'pains_list_title': 'Existing Pains/Conditions:',
                'pain1': 'Jaw clicking (Left TMJ)',
                'pain2': 'Morning headaches',
                'pain3': 'Reflux (GERD)',
                'btn_update_goals': 'Update Pains & Goals',
                'sec_interventions_title': 'Treatment Interventions',
                'appliance_title': 'Start Thriving Appliance (TM)',
                'appliance_subtitle': 'Visualizing your appliance adjustment journey.',
                'appliance_duration_label': 'Prescription Progress:',
                'completion_label': 'Complete',
                'app_start': 'Start (Month 0)',
                'app_current_marker': 'Current (Month 6)',
                'app_24m': 'Target (Month 24)',
                'status_at_month_title': 'Treatment Status at Month',
                'appliance_duration_text': `Prescription: ${totalPrescriptionMonths} months | ${monthsCompleted} months complete`,
                'adjustment_history_title': 'Adjustment History',
                // Appliance State Descriptions
                'state_m0_set': 'Initial Fit / 0.0mm Expansion',
                'state_m0_note': 'Appliance delivered. Focus on comfort and wear-time habit.',
                'state_m2_set': '1.5 Turns / 0.38mm Expansion',
                'state_m2_note': 'First adjustment phase. Slight pressure expected.',
                'state_m5_set': '2.0 Turns / 0.50mm Expansion',
                'state_m5_note': 'Active expansion phase. Monitor midline spacing.',
                'state_default': 'Maintenance Phase',
                'state_default_note': 'Continue prescribed wear. No active adjustment this month.',
                'btn_request_adjustment': 'Request Appliance Adjustment',
                'nutrition_title': 'Prescribed Nutrition Focus:',
                'nut_bonebroth': 'Increase intake of bone broth for collagen support.',
                'nut_calcium': 'Ensure adequate calcium and magnesium levels.',
                'nut_fattyacids': 'Focus on essential fatty acids (Omega-3).',
                'btn_order_supplements': 'Order Supplements Now',
                'sec_amc_support_title': 'AMC & Support',
                'amc_coordinator_title': 'Assigned Coordinator: Jane Chen (AMC)',
                'amc_coordinator_desc': 'Your dedicated health coach for administrative and non-clinical guidance.',
                'btn_arrange_appointment': 'Arrange AMC Appointment',
                'sec_diagnostics_title': 'AMD Diagnostic Inputs',
                'cbct_title': 'CB CT Scan (Airway)',
                'cbct_desc': 'Used to measure Minimal Cross Section (MCS).',
                'mcs_value': 'MCS: 285 mm²',
                'mcs_status': '(Critical!)',
                'cbct_note': 'Doctor Note (10/12/2025): Significant restriction noted in velopharynx. Immediate intervention required.',
                'btn_view_cbct': 'View Full Scan / Upload New',
                'intraoral_title': '3D Intra-Oral Scan (Teeth)',
                'intraoral_desc': 'Used for Schwarz Analysis measurements.',
                'schwarz_status': 'Schwarz Analysis Ready',
                'schwarz_note': 'Analysis shows 5mm maxillary posterior crossbite correction needed.',
                'btn_view_schwarz': 'View Analysis & Report',
                'ceph_title': 'Ceph Flow Metric Analysis',
                'ceph_desc': 'Used for Sassouni Plus Ceph Analysis.',
                'sassouni_status': 'Sassouni Plus Report',
                'sassouni_note': 'Informs appliance growth angles. Current FMA: 23°.',
                'btn_view_sassouni': 'View Report & Angles',
                'progress_title': 'Progress Photo Timeline',
                'progress_subtitle': 'Track your jaw and posture changes over the 18-month growth prescription period.',
                'timeline_summary': `Prescription Progress: ${monthsCompleted} Months Complete (${totalPrescriptionMonths - monthsCompleted} Months Remaining)`,
                'comparison_title': 'Historical Comparison View',
                'comp_c0': 'Initial (Month 0)', 
                'comp_c1': 'Month 3 Check',
                'comp_c2': 'Month 6 Check',
                'comp_c3': 'Month 12 Check',
                'comp_c4': 'Current Check',
                'upload_photo': 'Upload New Progress Photo',
                'sec_chat_title': 'Secure Group Chat',
                'chat_subtitle': 'Communicate directly with your Doctor and AMC.',
                'msg_doctor_title': 'Dr. Smith (Practitioner)',
                'msg_doctor_text': 'Hello, I have reviewed your latest CBCT. Please ensure you are wearing the appliance for the full prescribed time daily.',
                'msg_amc_title': 'Jane Chen (AMC)',
                'msg_amc_text': "I've scheduled your next nutrition coaching session for next Tuesday at 4 PM. Confirmation email sent.",
                'msg_client_title': 'You (Client)',
                'msg_client_text': "Understood, Dr. Smith. I've been consistent. Jane, thank you for setting that up!",
                'btn_send': 'Send',
                'toggle_text': '中文',
                'photo_jaw_front': 'Jaw (Front)',
                'photo_posture_side': 'Posture (Side)',
                'photo_jaw_side': 'Jaw (Side)',
                'photo_jaw_bottom': 'Jaw (Bottom)',
                'date_c0': 'Initial Baseline (20/09/2025)',
                'date_c1': 'Month 3 (20/12/2025)',
                'date_c2': 'Month 6 (20/03/2026)',
                'date_c3': 'Month 12 (20/09/2026)',
                'date_c4': 'Current (15/12/2026)' 
            },
            'zh': {
                'header_title': 'AMD 客戶儀表板',
                'logout_link': '← 登出 / 入口網站',
                'nav_title': '導航',
                'tab_my_plan': '我的計劃與支持',
                'tab_diagnostics': '診斷輸入',
                'tab_progress': '進度追踪器',
                'tab_chat': '安全群組聊天',
                'sec_goals_title_impact': '我的旅程：目標與動力',
                'goals_motivation_intro': '專注於這些目標—它們是我們正在通過整體治療共同努力消除的強大症狀。',
                'sec_goals_title': '我的目標與疼痛',
                'goals_list_title': '我的 3 個欲消除症狀:',
                'goal1': '慢性白天疲勞',
                'goal2': '頻繁頸部/肩部緊張',
                'goal3': '醒來時口乾',
                'pains_list_title': '現有疼痛/狀況:',
                'pain1': '下巴顳顎關節(左側)咯咯作響',
                'pain2': '早上頭痛',
                'pain3': '胃食道逆流 (GERD)',
                'btn_update_goals': '更新疼痛與目標',
                'sec_interventions_title': '治療干預措施',
                'appliance_title': '開始興盛矯治器 (TM)',
                'appliance_subtitle': '可視化您的矯治器調整旅程。',
                'appliance_duration_label': '處方進度:',
                'completion_label': '完成',
                'app_start': '開始 (第 0 個月)',
                'app_current_marker': '當前 (第 6 個月)',
                'app_24m': '目標 (第 24 個月)',
                'status_at_month_title': '治療狀態：第',
                'appliance_duration_text': `處方: ${totalPrescriptionMonths} 個月 | 完成 ${monthsCompleted} 個月`,
                'adjustment_history_title': '調整歷史記錄', 
                // Appliance State Descriptions
                'state_m0_set': '初始佩戴 / 0.0mm 擴展',
                'state_m0_note': '矯治器已交付。專注於舒適度和佩戴習慣。',
                'state_m2_set': '1.5 圈 / 0.38mm 擴展',
                'state_m2_note': '第一階段調整。預計會有輕微壓力。',
                'state_m5_set': '2.0 圈 / 0.50mm 擴展',
                'state_m5_note': '活躍擴展階段。監測中線間距。',
                'state_default': '維護階段',
                'state_default_note': '繼續按處方佩戴。本月無主動調整。',
                'btn_request_adjustment': '請求矯治器調整',
                'nutrition_title': '處方營養重點:',
                'nut_bonebroth': '增加骨湯攝取以支持膠原蛋白。',
                'nut_calcium': '確保充足的鈣和鎂水平。',
                'nut_fattyacids': '專注於必需脂肪酸 (Omega-3)。',
                'btn_order_supplements': '立即訂購補充劑',
                'sec_amc_support_title': 'AMC 與支持',
                'amc_coordinator_title': '指定協調員: Jane Chen (AMC)',
                'amc_coordinator_desc': '您專屬的健康教練，提供行政和非臨床指導。',
                'btn_arrange_appointment': '安排 AMC 預約',
                'sec_diagnostics_title': 'AMD 診斷輸入',
                'cbct_title': '錐束CT掃描 (氣道)',
                'cbct_desc': '用於測量最小橫截面積 (MCS)。',
                'mcs_value': 'MCS: 285 毫米²',
                'mcs_status': '(危急!)',
                'cbct_note': '醫生備註 (2025/12/10): 鼻咽部有明顯受限。需立即干預。',
                'btn_view_cbct': '查看完整掃描 / 上傳新掃描',
                'intraoral_title': '3D 口內掃描 (牙齒)',
                'intraoral_desc': '用於 Schwarz 分析測量。',
                'schwarz_status': 'Schwarz 分析準備就緒',
                'schwarz_note': '分析顯示上頜後部需要矯正 5 毫米的反頜。',
                'btn_view_schwarz': '查看分析與報告',
                'ceph_title': '頭影流動測量分析',
                'ceph_desc': '用於 Sassouni Plus 頭影分析。',
                'sassouni_status': 'Sassouni Plus 報告',
                'sassouni_note': '指導矯治器生長角度。當前 FMA: 23°。',
                'btn_view_sassouni': '查看報告與角度',
                'progress_title': '進度照片追踪器',
                'progress_subtitle': '追踪您在 18 個月生長處方期內的下巴和姿勢變化。',
                'timeline_summary': `處方進度: 完成 ${monthsCompleted} 個月 (剩餘 ${totalPrescriptionMonths - monthsCompleted} 個月)`,
                'comparison_title': '歷史比較視圖',
                'comp_c0': '初始 (第 0 個月)',
                'comp_c1': '第 3 個月檢查',
                'comp_c2': '第 6 個月檢查',
                'comp_c3': '第 12 個月檢查',
                'comp_c4': '當前檢查',
                'upload_photo': '上傳新進度照片',
                'sec_chat_title': '安全群組聊天',
                'chat_subtitle': '與您的醫生和 AMC 直接溝通。',
                'msg_doctor_title': 'Smith 醫生 (醫生)',
                'msg_doctor_text': '您好，我已經審閱了您最新的 CBCT。請確保每天在規定的時間內全程佩戴矯治器。',
                'msg_amc_title': 'Jane Chen (AMC)',
                'msg_amc_text': '我已經為您預約了下週二下午 4 點的營養指導課程。確認郵件已發送。',
                'msg_client_title': '您 (客戶)',
                'msg_client_text': '明白了，Smith 醫生。我一直很堅持。Jane，謝謝您的安排！',
                'btn_send': '發送',
                'toggle_text': 'English',
                'photo_jaw_front': '下巴 (正面)',
                'photo_posture_side': '姿勢 (側面)',
                'photo_jaw_side': '下巴 (側面)',
                'photo_jaw_bottom': '下巴 (底部)',
                'date_c0': '初始基線 (2025/09/20)',
                'date_c1': '第 3 個月 (2025/12/20)',
                'date_c2': '第 6 個月 (2026/03/20)',
                'date_c3': '第 12 個月 (2026/09/20)',
                'date_c4': '當前 (2026/12/15)' 
            }
        };

        // --- Appliance Timeline Logic ---
        // Mock data state for specific months
        const applianceStates = {
            0: { setKey: 'state_m0_set', noteKey: 'state_m0_note', expansion: '0.0mm' },
            2: { setKey: 'state_m2_set', noteKey: 'state_m2_note', expansion: '0.38mm' },
            5: { setKey: 'state_m5_set', noteKey: 'state_m5_note', expansion: '0.50mm' }
            // All other months fallback to 'state_default'
        };

        function updateApplianceTimeline(monthValue) {
            const month = parseInt(monthValue);
            const langData = translations[currentLang];
            
            // Safety guard: prevent sliding past current completed month
            if (month > monthsCompleted) {
                document.getElementById('appliance-timeline-slider').value = monthsCompleted;
                return;
            }

            // 1. Update Month Display
            document.getElementById('display-month').textContent = month;

            // 2. Find State (Look for exact match or nearest past match)
            let state = applianceStates[month];
            if (!state) {
                // Find nearest previous state
                let keys = Object.keys(applianceStates).map(Number).sort((a, b) => b - a);
                let nearestKey = keys.find(k => k <= month);
                state = nearestKey !== undefined ? applianceStates[nearestKey] : applianceStates[0];
                
                // If it's not an exact adjustment month, use maintenance text
                if (nearestKey !== month) {
                     state = { 
                         setKey: 'state_default', 
                         noteKey: 'state_default_note', 
                         expansion: state.expansion // Keep expansion same as last adjustment
                     };
                }
            }

            // 3. Update Text Content
            document.getElementById('appliance-setting-text').textContent = langData[state.setKey] || langData['state_default'];
            document.getElementById('appliance-notes-text').textContent = langData[state.noteKey] || langData['state_default_note'];

            // 4. Update Image (Placeholder simulating expansion state)
            const expansionValue = state.expansion || 'Unknown';
            // Using placeholder color to simulate change, yellow intensity increases with months
            const colorIntensity = 200 + (month * 10); 
            // Clamp color max
            const safeColor = Math.min(colorIntensity, 255).toString(16);
            const hexColor = `fcd34d`; // Keeping consistent yellow base for now

            const imgUrl = `https://placehold.co/400x250/${hexColor}/ffffff?text=Appliance+State:+Month+${month}\nExpansion:+${expansionValue}`;
            document.getElementById('appliance-image').src = imgUrl;
        }
        
        // --- Core Translation Function ---
        function updateText() {
            const langData = translations[currentLang];
            
            // Update elements with data-key attribute
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                if (langData[key]) {
                    element.textContent = langData[key];
                }
            });

            // Update complex elements (like input placeholders)
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.placeholder = currentLang === 'en' ? 'Type your message...' : '輸入您的訊息...';
            }

            // Update specific dynamic texts
            document.getElementById('appliance-percentage').textContent = `${percentageCompleted}%`;
            
            // Update language toggle button text
            document.getElementById('lang-toggle').textContent = langData.toggle_text;

            // Update HTML lang attribute
            document.documentElement.setAttribute('lang', currentLang);
            
            // Update document title
            document.title = currentLang === 'en' ? 'AMD Client Dashboard | Tabbed View' : 'AMD 客戶儀表板 | 分頁視圖';
            
            // Re-run comparison view update to refresh image labels
            updateComparisonView(document.getElementById('comparison-slider')?.value || 0);
            
            // Re-run appliance timeline update to refresh its labels
            updateApplianceTimeline(document.getElementById('appliance-timeline-slider').value);
        }

        // Function to handle the language toggle
        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'zh' : 'en';
            updateText();
        }

        function switchTab(tabId) {
            // 1. Hide all content tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // 2. Deactivate all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // 3. Show the requested content tab
            const activeContent = document.getElementById('tab-' + tabId);
            if (activeContent) {
                activeContent.classList.remove('hidden');
            }

            // 4. Activate the clicked button
            const activeButton = document.querySelector(`[onclick="switchTab('${tabId}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }

        // Function to update the images and label in the Progress Tracker tab based on slider value
        function updateComparisonView(sliderValue) {
            const langData = translations[currentLang];
            const grid = document.getElementById('photo-comparison-grid');
            const label = document.getElementById('comparison-label');
            
            // Mapping for 5 checkpoints (0 to 4)
            const checkpointData = [
                { titleKey: 'comp_c0', dateKey: 'date_c0', phase: '(Initial)' },
                { titleKey: 'comp_c1', dateKey: 'date_c1', phase: '(Month 3)' },
                { titleKey: 'comp_c2', dateKey: 'date_c2', phase: '(Month 6)' },
                { titleKey: 'comp_c3', dateKey: 'date_c3', phase: '(Month 12)' },
                { titleKey: 'comp_c4', dateKey: 'date_c4', phase: '(Current)' }
            ];
            
            const currentCheckpoint = checkpointData[sliderValue];

            label.textContent = langData.comparison_title + `: ${langData[currentCheckpoint.dateKey]}`;

            // Image Placeholders - using unique colors for visual differentiation of photo types
            const photos = [
                { titleKey: 'photo_jaw_front', color: '4c7c8c' },
                { titleKey: 'photo_posture_side', color: '8c4c7c' },
                { titleKey: 'photo_jaw_side', color: '7c8c4c' },
                { titleKey: 'photo_jaw_bottom', color: '4c8c7c' }
            ];

            // Generate HTML for comparison photos
            grid.innerHTML = photos.map(photo => `
                <div class="flex flex-col items-center p-2 border rounded-lg bg-white shadow-sm">
                    <img src="https://placehold.co/180x200/${photo.color}/ffffff?text=${langData[photo.titleKey]}\n${currentCheckpoint.phase}" alt="${langData[photo.titleKey]} ${currentCheckpoint.phase}" class="w-full rounded-lg mb-2">
                    <span class="text-xs text-gray-700 font-medium">${langData[photo.titleKey]}</span>
                </div>
            `).join('');
        }

        // Initialize the page on load
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('my-plan'); // Set default tab
            updateText(); // Load translations and initialize sliders/percentages
        });
    </script>
</body>
</html>
